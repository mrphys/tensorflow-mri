<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../../genindex/" /><link rel="search" title="Search" href="../../../search/" /><link rel="next" title="TensorFlow MRI API documentation" href="../../../api_docs/" /><link rel="prev" title="Image reconstruction" href="../" />
        <link rel="canonical" href="https://mrphys.github.io/tensorflow-mri/tutorials/recon/cg_sense.html" />

    <link rel="shortcut icon" href="../../../_static/tfmri_icon.svg"/><meta name="generator" content="sphinx-4.4.0, furo 2022.04.07"/>
        <title>Image reconstruction with CG-SENSE - TensorFlow MRI Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #128091;
  --color-brand-content: #128091;
  --font-stack: Roboto, sans-serif;
  --font-stack--monospace: Roboto Mono, monospace;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #18A8BE;
  --color-brand-content: #18A8BE;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #18A8BE;
  --color-brand-content: #18A8BE;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../"><div class="brand">TensorFlow MRI Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/tfmri_logo.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/tmfri_logo_dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search/" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/">Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/install/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/faq/">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../">Tutorials</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">Image reconstruction</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">CG-SENSE</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api_docs/">API documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/">tfmri</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/broadcast_dynamic_shapes/">broadcast_dynamic_shapes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/broadcast_static_shapes/">broadcast_static_shapes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/cartesian_product/">cartesian_product</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/central_crop/">central_crop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/meshgrid/">meshgrid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/ravel_multi_index/">ravel_multi_index</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/resize_with_crop_or_pad/">resize_with_crop_or_pad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/scale_by_min_max/">scale_by_min_max</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/unravel_index/">unravel_index</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/callbacks/">tfmri.callbacks</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/callbacks/TensorBoardImages/">TensorBoardImages</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/coils/">tfmri.coils</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/coils/CoilCompressorSVD/">CoilCompressorSVD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/coils/combine_coils/">combine_coils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/coils/compress_coils/">compress_coils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/coils/estimate_sensitivities/">estimate_sensitivities</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/convex/">tfmri.convex</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunction/">ConvexFunction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionAffineMappingComposition/">ConvexFunctionAffineMappingComposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionIndicatorBall/">ConvexFunctionIndicatorBall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionIndicatorL1Ball/">ConvexFunctionIndicatorL1Ball</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionIndicatorL2Ball/">ConvexFunctionIndicatorL2Ball</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL1Norm/">ConvexFunctionL1Norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL2Norm/">ConvexFunctionL2Norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL2NormSquared/">ConvexFunctionL2NormSquared</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionLeastSquares/">ConvexFunctionLeastSquares</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionLinearOperatorComposition/">ConvexFunctionLinearOperatorComposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionNorm/">ConvexFunctionNorm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionQuadratic/">ConvexFunctionQuadratic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionTikhonov/">ConvexFunctionTikhonov</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionTotalVariation/">ConvexFunctionTotalVariation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/convex/admm_minimize/">admm_minimize</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/image/">tfmri.image</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/extract_glimpses/">extract_glimpses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/gmsd/">gmsd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/gmsd2d/">gmsd2d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/gmsd3d/">gmsd3d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/gradient_magnitude/">gradient_magnitude</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/image_gradients/">image_gradients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/phantom/">phantom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/psnr/">psnr</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/psnr2d/">psnr2d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/psnr3d/">psnr3d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/ssim/">ssim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/ssim2d/">ssim2d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/ssim2d_multiscale/">ssim2d_multiscale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/ssim3d/">ssim3d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/ssim3d_multiscale/">ssim3d_multiscale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/ssim_multiscale/">ssim_multiscale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/image/total_variation/">total_variation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/initializers/">tfmri.initializers</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/GlorotNormal/">GlorotNormal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/GlorotUniform/">GlorotUniform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/HeNormal/">HeNormal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/HeUniform/">HeUniform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/LecunNormal/">LecunNormal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/LecunUniform/">LecunUniform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/initializers/VarianceScaling/">VarianceScaling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/io/">tfmri.io</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/io/encode_gif/">encode_gif</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/io/parse_twix/">parse_twix</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/layers/">tfmri.layers</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/AveragePooling1D/">AveragePooling1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/AveragePooling2D/">AveragePooling2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/AveragePooling3D/">AveragePooling3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/Conv1D/">Conv1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/Conv2D/">Conv2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/Conv3D/">Conv3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/ConvBlock/">ConvBlock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/DWT1D/">DWT1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/DWT2D/">DWT2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/DWT3D/">DWT3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/IDWT1D/">IDWT1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/IDWT2D/">IDWT2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/IDWT3D/">IDWT3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/MaxPooling1D/">MaxPooling1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/MaxPooling2D/">MaxPooling2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/MaxPooling3D/">MaxPooling3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/layers/UNet/">UNet</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/linalg/">tfmri.linalg</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperator/">LinearOperator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorAddition/">LinearOperatorAddition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorAdjoint/">LinearOperatorAdjoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorComposition/">LinearOperatorComposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorDiag/">LinearOperatorDiag</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorFiniteDifference/">LinearOperatorFiniteDifference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorGramMatrix/">LinearOperatorGramMatrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorMRI/">LinearOperatorMRI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorScaledIdentity/">LinearOperatorScaledIdentity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/linalg/conjugate_gradient/">conjugate_gradient</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/losses/">tfmri.losses</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/ConfusionLoss/">ConfusionLoss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/F1Loss/">F1Loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/FocalTverskyLoss/">FocalTverskyLoss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/IoULoss/">IoULoss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/SSIMLoss/">SSIMLoss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/SSIMMultiscaleLoss/">SSIMMultiscaleLoss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/TverskyLoss/">TverskyLoss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/ssim_loss/">ssim_loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/losses/ssim_multiscale_loss/">ssim_multiscale_loss</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/math/">tfmri.math</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/block_soft_threshold/">block_soft_threshold</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/extract_from_complex/">extract_from_complex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/indicator_ball/">indicator_ball</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/indicator_box/">indicator_box</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/indicator_simplex/">indicator_simplex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/make_val_and_grad_fn/">make_val_and_grad_fn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/normalize_no_nan/">normalize_no_nan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/project_onto_ball/">project_onto_ball</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/project_onto_box/">project_onto_box</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/project_onto_simplex/">project_onto_simplex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/shrinkage/">shrinkage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/math/soft_threshold/">soft_threshold</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/metrics/">tfmri.metrics</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/Accuracy/">Accuracy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/ConfusionMetric/">ConfusionMetric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/F1Score/">F1Score</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/FBetaScore/">FBetaScore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/IoU/">IoU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/NegativePredictiveValue/">NegativePredictiveValue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/PSNR/">PSNR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/PositivePredictiveValue/">PositivePredictiveValue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/SSIM/">SSIM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/SSIMMultiscale/">SSIMMultiscale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/TrueNegativeRate/">TrueNegativeRate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/TruePositiveRate/">TruePositiveRate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/metrics/TverskyIndex/">TverskyIndex</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/models/">tfmri.models</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/models/ConvBlock1D/">ConvBlock1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/models/ConvBlock2D/">ConvBlock2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/models/ConvBlock3D/">ConvBlock3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/models/UNet1D/">UNet1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/models/UNet2D/">UNet2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/models/UNet3D/">UNet3D</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/optimize/">tfmri.optimize</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/optimize/gradient_descent/">gradient_descent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/optimize/lbfgs_minimize/">lbfgs_minimize</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/plot/">tfmri.plot</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/plot/close/">close</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/plot/image_sequence/">image_sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/plot/show/">show</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/plot/tiled_image/">tiled_image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/plot/tiled_image_sequence/">tiled_image_sequence</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/recon/">tfmri.recon</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/recon/adjoint/">adjoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/recon/grappa/">grappa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/recon/least_squares/">least_squares</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/recon/partial_fourier/">partial_fourier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/recon/sense/">sense</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/sampling/">tfmri.sampling</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/density_grid/">density_grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/estimate_density/">estimate_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/estimate_radial_density/">estimate_radial_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/expand_density/">expand_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/expand_trajectory/">expand_trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/flatten_density/">flatten_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/flatten_trajectory/">flatten_trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/radial_density/">radial_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/radial_trajectory/">radial_trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/radial_waveform/">radial_waveform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/random_mask/">random_mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/sampling/spiral_trajectory/">spiral_trajectory</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/signal/">tfmri.signal</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/atanfilt/">atanfilt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/crop_kspace/">crop_kspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/dwt/">dwt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/fft/">fft</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/filter_kspace/">filter_kspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/hamming/">hamming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/hann/">hann</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/idwt/">idwt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/ifft/">ifft</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/signal/nufft/">nufft</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_docs/tfmri/summary/">tfmri.summary</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_docs/tfmri/summary/gif/">gif</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Image-reconstruction-with-CG-SENSE">
<h1>Image reconstruction with CG-SENSE<a class="headerlink" href="#Image-reconstruction-with-CG-SENSE" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://mrphys.github.io/tensorflow-mri/tutorials/recon/cg_sense"><img alt="View on website" src="https://img.shields.io/badge/-View%20on%20website-128091?labelColor=grey&amp;logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYwIiBoZWlnaHQ9IjI1OSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI+PGRlZnM+PGNsaXBQYXRoIGlkPSJjbGlwMCI+PHJlY3QgeD0iMTI2NCIgeT0iMTIzOCIgd2lkdGg9IjI2MCIgaGVpZ2h0PSIyNTkiLz48L2NsaXBQYXRoPjxsaW5lYXJHcmFkaWVudCB4MT0iMTI2NCIgeTE9IjEzNjcuNSIgeDI9IjE1MjQiIHkyPSIxMzY3LjUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBzcHJlYWRNZXRob2Q9InJlZmxlY3QiIGlkPSJmaWxsMSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMTI4MDkxIi8+PHN0b3Agb2Zmc2V0PSIwLjAyMjcyNzMiIHN0b3AtY29sb3I9IiMxMjgxOTIiLz48c3RvcCBvZmZzZXQ9IjAuMDQ1NDU0NSIgc3RvcC1jb2xvcj0iIzEyODM5NCIvPjxzdG9wIG9mZnNldD0iMC4wNjgxODE4IiBzdG9wLWNvbG9yPSIjMTI4NDk2Ii8+PHN0b3Agb2Zmc2V0PSIwLjA5MDkwOTEiIHN0b3AtY29sb3I9IiMxMjg2OTgiLz48c3RvcCBvZmZzZXQ9IjAuMTEzNjM2IiBzdG9wLWNvbG9yPSIjMTM4ODlBIi8+PHN0b3Agb2Zmc2V0PSIwLjEzNjM2NCIgc3RvcC1jb2xvcj0iIzEzODk5QiIvPjxzdG9wIG9mZnNldD0iMC4xNTkwOTEiIHN0b3AtY29sb3I9IiMxMzhCOUQiLz48c3RvcCBvZmZzZXQ9IjAuMTgxODE4IiBzdG9wLWNvbG9yPSIjMTM4QzlGIi8+PHN0b3Agb2Zmc2V0PSIwLjIwNDU0NSIgc3RvcC1jb2xvcj0iIzE0OERBMCIvPjxzdG9wIG9mZnNldD0iMC4yMjcyNzMiIHN0b3AtY29sb3I9IiMxNDhGQTIiLz48c3RvcCBvZmZzZXQ9IjAuMjUiIHN0b3AtY29sb3I9IiMxNDkwQTMiLz48c3RvcCBvZmZzZXQ9IjAuMjcyNzI3IiBzdG9wLWNvbG9yPSIjMTQ5MUE1Ii8+PHN0b3Agb2Zmc2V0PSIwLjI5NTQ1NSIgc3RvcC1jb2xvcj0iIzE0OTNBNiIvPjxzdG9wIG9mZnNldD0iMC4zMTgxODIiIHN0b3AtY29sb3I9IiMxNTk0QTgiLz48c3RvcCBvZmZzZXQ9IjAuMzQwOTA5IiBzdG9wLWNvbG9yPSIjMTU5NUE5Ii8+PHN0b3Agb2Zmc2V0PSIwLjM2MzYzNiIgc3RvcC1jb2xvcj0iIzE1OTZBQSIvPjxzdG9wIG9mZnNldD0iMC4zODYzNjQiIHN0b3AtY29sb3I9IiMxNTk3QUIiLz48c3RvcCBvZmZzZXQ9IjAuNDA5MDkxIiBzdG9wLWNvbG9yPSIjMTU5OUFEIi8+PHN0b3Agb2Zmc2V0PSIwLjQzMTgxOCIgc3RvcC1jb2xvcj0iIzE1OUFBRSIvPjxzdG9wIG9mZnNldD0iMC40NTQ1NDUiIHN0b3AtY29sb3I9IiMxNjlCQUYiLz48c3RvcCBvZmZzZXQ9IjAuNDc3MjczIiBzdG9wLWNvbG9yPSIjMTY5Q0IwIi8+PHN0b3Agb2Zmc2V0PSIwLjUiIHN0b3AtY29sb3I9IiMxNjlEQjEiLz48c3RvcCBvZmZzZXQ9IjAuNTIyNzI3IiBzdG9wLWNvbG9yPSIjMTY5RUIyIi8+PHN0b3Agb2Zmc2V0PSIwLjU0NTQ1NSIgc3RvcC1jb2xvcj0iIzE2OUVCMyIvPjxzdG9wIG9mZnNldD0iMC41NjgxODIiIHN0b3AtY29sb3I9IiMxNjlGQjQiLz48c3RvcCBvZmZzZXQ9IjAuNTkwOTA5IiBzdG9wLWNvbG9yPSIjMTZBMEI1Ii8+PHN0b3Agb2Zmc2V0PSIwLjYxMzYzNiIgc3RvcC1jb2xvcj0iIzE2QTFCNiIvPjxzdG9wIG9mZnNldD0iMC42MzYzNjQiIHN0b3AtY29sb3I9IiMxN0ExQjciLz48c3RvcCBvZmZzZXQ9IjAuNjU5MDkxIiBzdG9wLWNvbG9yPSIjMTdBMkI4Ii8+PHN0b3Agb2Zmc2V0PSIwLjY4MTgxOCIgc3RvcC1jb2xvcj0iIzE3QTNCOCIvPjxzdG9wIG9mZnNldD0iMC43MDQ1NDUiIHN0b3AtY29sb3I9IiMxN0EzQjkiLz48c3RvcCBvZmZzZXQ9IjAuNzI3MjczIiBzdG9wLWNvbG9yPSIjMTdBNEJBIi8+PHN0b3Agb2Zmc2V0PSIwLjc1IiBzdG9wLWNvbG9yPSIjMTdBNUJBIi8+PHN0b3Agb2Zmc2V0PSIwLjc3MjcyNyIgc3RvcC1jb2xvcj0iIzE3QTVCQiIvPjxzdG9wIG9mZnNldD0iMC43OTU0NTUiIHN0b3AtY29sb3I9IiMxN0E1QkIiLz48c3RvcCBvZmZzZXQ9IjAuODE4MTgyIiBzdG9wLWNvbG9yPSIjMTdBNkJDIi8+PHN0b3Agb2Zmc2V0PSIwLjg0MDkwOSIgc3RvcC1jb2xvcj0iIzE3QTZCQyIvPjxzdG9wIG9mZnNldD0iMC44NjM2MzYiIHN0b3AtY29sb3I9IiMxN0E3QkMiLz48c3RvcCBvZmZzZXQ9IjAuODg2MzY0IiBzdG9wLWNvbG9yPSIjMTdBN0JEIi8+PHN0b3Agb2Zmc2V0PSIwLjkwOTA5MSIgc3RvcC1jb2xvcj0iIzE3QTdCRCIvPjxzdG9wIG9mZnNldD0iMC45MzE4MTgiIHN0b3AtY29sb3I9IiMxN0E3QkQiLz48c3RvcCBvZmZzZXQ9IjAuOTU0NTQ1IiBzdG9wLWNvbG9yPSIjMTdBN0JEIi8+PHN0b3Agb2Zmc2V0PSIwLjk3NzI3MyIgc3RvcC1jb2xvcj0iIzE3QTdCRCIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzE4QThCRSIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMCkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMjY0IC0xMjM4KSI+PHBhdGggZD0iTTEzOTQgMTMwMi43NUMxMzU4LjEgMTMwMi43NSAxMzI5IDEzMzEuNzQgMTMyOSAxMzY3LjUgMTMyOSAxNDAzLjI2IDEzNTguMSAxNDMyLjI1IDEzOTQgMTQzMi4yNSAxNDI5LjkgMTQzMi4yNSAxNDU5IDE0MDMuMjYgMTQ1OSAxMzY3LjUgMTQ1OSAxMzMxLjc0IDE0MjkuOSAxMzAyLjc1IDEzOTQgMTMwMi43NVpNMTM5NCAxMjg5LjhDMTQzNy4wOCAxMjg5LjggMTQ3MiAxMzI0LjU5IDE0NzIgMTM2Ny41IDE0NzIgMTQxMC40MSAxNDM3LjA4IDE0NDUuMiAxMzk0IDE0NDUuMiAxMzUwLjkyIDE0NDUuMiAxMzE2IDE0MTAuNDEgMTMxNiAxMzY3LjUgMTMxNiAxMzI0LjU5IDEzNTAuOTIgMTI4OS44IDEzOTQgMTI4OS44Wk0xMzk0IDEyNzYuODVDMTM0My43NCAxMjc2Ljg1IDEzMDMgMTMxNy40NCAxMzAzIDEzNjcuNSAxMzAzIDE0MTcuNTYgMTM0My43NCAxNDU4LjE1IDEzOTQgMTQ1OC4xNSAxNDQ0LjI2IDE0NTguMTUgMTQ4NSAxNDE3LjU2IDE0ODUgMTM2Ny41IDE0ODUgMTMxNy40NCAxNDQ0LjI2IDEyNzYuODUgMTM5NCAxMjc2Ljg1Wk0xMzk0IDEyMzhDMTQ2NS44IDEyMzggMTUyNCAxMjk1Ljk4IDE1MjQgMTM2Ny41IDE1MjQgMTQzOS4wMiAxNDY1LjggMTQ5NyAxMzk0IDE0OTcgMTMyMi4yIDE0OTcgMTI2NCAxNDM5LjAyIDEyNjQgMTM2Ny41IDEyNjQgMTI5NS45OCAxMzIyLjIgMTIzOCAxMzk0IDEyMzhaIiBmaWxsPSJ1cmwoI2ZpbGwxKSIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9nPjwvc3ZnPg=="/></a> <a class="reference external" href="https://colab.research.google.com/github/mrphys/tensorflow-mri/blob/master/tools/docs/tutorials/recon/cg_sense.ipynb"><img alt="Run in Colab" src="https://img.shields.io/badge/-Run%20in%20Colab-128091?labelColor=grey&amp;logo=googlecolab"/></a> <a class="reference external" href="https://github.com/mrphys/tensorflow-mri/blob/master/tools/docs/tutorials/recon/cg_sense.ipynb"><img alt="View on GitHub" src="https://img.shields.io/badge/-View%20on%20GitHub-128091?labelColor=grey&amp;logo=github"/></a> <a class="reference external" href="https://raw.githubusercontent.com/mrphys/tensorflow-mri/master/tools/docs/tutorials/recon/cg_sense.ipynb"><img alt="Download notebook" src="https://img.shields.io/badge/-Download%20notebook-128091?labelColor=grey&amp;logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmc1NSIKICAgd2lkdGg9IjI0IgogICBoZWlnaHQ9IjI0IgogICB2aWV3Qm94PSIwIDAgMjQgMjQiCiAgIHNvZGlwb2RpOmRvY25hbWU9Imljb25zOC1kb3dubG9hZC05Ni5wbmciCiAgIGlua3NjYXBlOnZlcnNpb249IjEuMS4yICgxOjEuMSsyMDIyMDIwNTA5NDIrMGEwMGNmNTMzOSkiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnMKICAgICBpZD0iZGVmczU5Ij4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDM3NDAiCiAgICAgICBpc192aXNpYmxlPSJ0cnVlIgogICAgICAgbHBldmVyc2lvbj0iMSIKICAgICAgIHNhdGVsbGl0ZXNfcGFyYW09IkYsMCwwLDEsMCw0LDAsMSBAIEYsMCwwLDEsMCw0LDAsMSBAIEYsMCwwLDEsMCw0LDAsMSBAIEYsMCwwLDEsMCw0LDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iNCIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDM3MjAiCiAgICAgICBpc192aXNpYmxlPSJ0cnVlIgogICAgICAgbHBldmVyc2lvbj0iMSIKICAgICAgIHNhdGVsbGl0ZXNfcGFyYW09IkYsMCwwLDEsMCwxLDAsMSBAIEYsMCwwLDEsMCwxLDAsMSBAIEYsMCwwLDEsMCwxLDAsMSBAIEYsMCwwLDEsMCwxLDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iMSIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDM1MTciCiAgICAgICBpc192aXNpYmxlPSJ0cnVlIgogICAgICAgbHBldmVyc2lvbj0iMSIKICAgICAgIHNhdGVsbGl0ZXNfcGFyYW09IkYsMCwwLDEsMCwwLDAsMSBAIEYsMCwwLDEsMCwwLDAsMSBAIEYsMCwwLDEsMCwwLDAsMSBAIEYsMCwwLDEsMCwwLDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iNCIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDMzNjAiCiAgICAgICBpc192aXNpYmxlPSJ0cnVlIgogICAgICAgbHBldmVyc2lvbj0iMSIKICAgICAgIHNhdGVsbGl0ZXNfcGFyYW09IkYsMCwwLDEsMCwwLDAsMSBAIEYsMCwwLDEsMCwwLDAsMSBAIEYsMCwwLDEsMCwwLDAsMSBAIEYsMCwwLDEsMCwwLDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iNCIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDMzMTIiCiAgICAgICBpc192aXNpYmxlPSJ0cnVlIgogICAgICAgbHBldmVyc2lvbj0iMSIKICAgICAgIHNhdGVsbGl0ZXNfcGFyYW09IkYsMCwwLDEsMCwzLDAsMSBAIEYsMCwwLDEsMCwzLDAsMSBAIEYsMCwwLDEsMCwzLDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iNCIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDE5ODciCiAgICAgICBpc192aXNpYmxlPSJ0cnVlIgogICAgICAgbHBldmVyc2lvbj0iMSIKICAgICAgIHNhdGVsbGl0ZXNfcGFyYW09IkYsMCwwLDEsMCw0LDAsMSBAIEYsMCwwLDEsMCw0LDAsMSBAIEYsMCwwLDEsMCw0LDAsMSBAIEYsMCwwLDEsMCw0LDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iNCIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDkyOSIKICAgICAgIGlzX3Zpc2libGU9InRydWUiCiAgICAgICBscGV2ZXJzaW9uPSIxIgogICAgICAgc2F0ZWxsaXRlc19wYXJhbT0iRiwwLDAsMSwwLDQsMCwxIEAgRiwwLDAsMSwwLDQsMCwxIEAgRiwwLDAsMSwwLDQsMCwxIEAgRiwwLDAsMSwwLDQsMCwxIgogICAgICAgdW5pdD0icHgiCiAgICAgICBtZXRob2Q9ImF1dG8iCiAgICAgICBtb2RlPSJGIgogICAgICAgcmFkaXVzPSI0IgogICAgICAgY2hhbWZlcl9zdGVwcz0iMSIKICAgICAgIGZsZXhpYmxlPSJmYWxzZSIKICAgICAgIHVzZV9rbm90X2Rpc3RhbmNlPSJ0cnVlIgogICAgICAgYXBwbHlfbm9fcmFkaXVzPSJ0cnVlIgogICAgICAgYXBwbHlfd2l0aF9yYWRpdXM9InRydWUiCiAgICAgICBvbmx5X3NlbGVjdGVkPSJmYWxzZSIKICAgICAgIGhpZGVfa25vdHM9ImZhbHNlIiAvPgogICAgPGlua3NjYXBlOnBhdGgtZWZmZWN0CiAgICAgICBlZmZlY3Q9ImZpbGxldF9jaGFtZmVyIgogICAgICAgaWQ9InBhdGgtZWZmZWN0NTYwIgogICAgICAgaXNfdmlzaWJsZT0idHJ1ZSIKICAgICAgIGxwZXZlcnNpb249IjEiCiAgICAgICBzYXRlbGxpdGVzX3BhcmFtPSJGLDAsMCwxLDAsNCwwLDEgQCBGLDAsMCwxLDAsNC4xMzIzMjUyLDAsMSBAIEYsMCwwLDEsMCw0LDAsMSIKICAgICAgIHVuaXQ9InB4IgogICAgICAgbWV0aG9kPSJhdXRvIgogICAgICAgbW9kZT0iRiIKICAgICAgIHJhZGl1cz0iNCIKICAgICAgIGNoYW1mZXJfc3RlcHM9IjEiCiAgICAgICBmbGV4aWJsZT0iZmFsc2UiCiAgICAgICB1c2Vfa25vdF9kaXN0YW5jZT0idHJ1ZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICAgIDxpbmtzY2FwZTpwYXRoLWVmZmVjdAogICAgICAgZWZmZWN0PSJmaWxsZXRfY2hhbWZlciIKICAgICAgIGlkPSJwYXRoLWVmZmVjdDI0OSIKICAgICAgIGlzX3Zpc2libGU9InRydWUiCiAgICAgICBscGV2ZXJzaW9uPSIxIgogICAgICAgc2F0ZWxsaXRlc19wYXJhbT0iRiwwLDAsMSwwLDMuNDY0MTAxNiwwLDEgQCBGLDAsMCwxLDAsMy40NjQxMDE2LDAsMSBAIEYsMCwwLDEsMCwzLjQ2NDEwMTYsMCwxIgogICAgICAgdW5pdD0icHgiCiAgICAgICBtZXRob2Q9ImF1dG8iCiAgICAgICBtb2RlPSJGIgogICAgICAgcmFkaXVzPSIyIgogICAgICAgY2hhbWZlcl9zdGVwcz0iMSIKICAgICAgIGZsZXhpYmxlPSJmYWxzZSIKICAgICAgIHVzZV9rbm90X2Rpc3RhbmNlPSJmYWxzZSIKICAgICAgIGFwcGx5X25vX3JhZGl1cz0idHJ1ZSIKICAgICAgIGFwcGx5X3dpdGhfcmFkaXVzPSJ0cnVlIgogICAgICAgb25seV9zZWxlY3RlZD0iZmFsc2UiCiAgICAgICBoaWRlX2tub3RzPSJmYWxzZSIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJuYW1lZHZpZXc1NyIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSIwIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOnNuYXAtZ2xvYmFsPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxNy4zNzUiCiAgICAgaW5rc2NhcGU6Y3g9Ii00LjQwMjg3NzciCiAgICAgaW5rc2NhcGU6Y3k9IjEwLjI0NDYwNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA0MyIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImxheWVyMSIKICAgICB3aWR0aD0iMjQwMDAwMHB4Ij4KICAgIDxpbmtzY2FwZTpncmlkCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBpZD0iZ3JpZDgwNCIgLz4KICA8L3NvZGlwb2RpOm5hbWVkdmlldz4KICA8ZwogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaWQ9ImxheWVyMSIKICAgICBpbmtzY2FwZTpsYWJlbD0iVmVjdG9ycyI+CiAgICA8cGF0aAogICAgICAgaWQ9InBhdGgyNzc5IgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MC4yOTA2NTUiCiAgICAgICBpbmtzY2FwZTp0cmFuc2Zvcm0tY2VudGVyLXg9IjAuMDMxODc5ODkyIgogICAgICAgaW5rc2NhcGU6dHJhbnNmb3JtLWNlbnRlci15PSIxLjAzMTg0OTQiCiAgICAgICBkPSJtIDExLDIgYSAxLDEgMCAwIDAgLTEsMSB2IDguMDEwMjU0IGwgLTQsLTAuMDA4OCBhIDAuMjk0NDkyNTMsMC4yOTQ0OTI1MiAwIDAgMCAtMC4yMDE2NjAzLDAuNTEwMjU0IGwgNS42MDU0NjkzLDUuMjI2NTYyIGEgMC44MTE4OTI0NSwwLjgxMTg5MjQ1IDAgMCAwIDEuMTAxNTYyLDAuMDA1NCBsIDUuNjkxNDA2LC01LjIwODAwNiBBIDAuMjkyMzA2NywwLjI5MjMwNjcgMCAwIDAgMTgsMTEuMDI3ODMyIGwgLTQsLTAuMDA4OCBWIDMgQSAxLDEgMCAwIDAgMTMsMiBaIiAvPgogICAgPHBhdGgKICAgICAgIGlkPSJyZWN0MTg4NyIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjAuMjUxNTc3IgogICAgICAgZD0ibSAzLDIwIGggMTggYSAxLDEgNDUgMCAxIDEsMSAxLDEgMTM1IDAgMSAtMSwxIEggMyBBIDEsMSA0NSAwIDEgMiwyMSAxLDEgMTM1IDAgMSAzLDIwIFoiIC8+CiAgPC9nPgo8L3N2Zz4K"/></a></p>
<section id="Set-up-TensorFlow-MRI">
<h2>Set up TensorFlow MRI<a class="headerlink" href="#Set-up-TensorFlow-MRI" title="Permalink to this headline">#</a></h2>
<p>If you have not yet installed TensorFlow MRI in your environment, you may do so now using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install -q tensorflow-mri
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-yellow-fg">WARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.
You should consider upgrading via the '/usr/local/bin/python3.8 -m pip install --upgrade pip' command.</span><span class="ansi-yellow-fg">
</span>Note: you may need to restart the kernel to use updated packages.
</pre></div></div>
</div>
<p>Then, import the package into your program to get started:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow_mri</span> <span class="k">as</span> <span class="nn">tfmri</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TensorFlow MRI version:"</span><span class="p">,</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-06-16 20:55:47.324410: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
TensorFlow MRI version: 0.20.0
</pre></div></div>
</div>
<p>We will also need a few additional packages:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib.collections</span> <span class="k">as</span> <span class="nn">mcol</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</pre></div>
</div>
</div>
<section id="Using-a-GPU">
<h3>Using a GPU<a class="headerlink" href="#Using-a-GPU" title="Permalink to this headline">#</a></h3>
<p>TensorFlow MRI supports CPU and GPU computation. If there is a GPU available in your environment and it is visible to TensorFlow, it will be used automatically.</p>
<blockquote>
<div><p>ℹ️ In Google Colab, you can enable GPU computation by clicking on <strong>Runtime &gt; Change runtime type</strong> and selecting <strong>GPU</strong> under <strong>Hardware accelerator</strong>.</p>
</div></blockquote>
<blockquote>
<div><p>ℹ️ You can control whether CPU or GPU is used for a particular operation via the <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/device">tf.device</a> context manager.</p>
</div></blockquote>
</section>
</section>
<section id="Prepare-the-data">
<h2>Prepare the data<a class="headerlink" href="#Prepare-the-data" title="Permalink to this headline">#</a></h2>
<p>We will be using an example brain dataset from the <a class="reference external" href="https://ismrm.github.io/rrsg/challenge_one/">ISMRM Reproducibility Challenge 1</a>. Let’s download it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_data_filename</span> <span class="o">=</span> <span class="s1">'rawdata_brain_radial_96proj_12ch.h5'</span>
<span class="n">brain_data_url</span> <span class="o">=</span> <span class="s2">"https://github.com/ISMRM/rrsg/raw/master/challenges/challenge_01/rawdata_brain_radial_96proj_12ch.h5"</span>
<span class="o">!</span>wget -O <span class="o">{</span>brain_data_filename<span class="o">}</span> <span class="o">{</span>brain_data_url<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2022-06-16 20:55:59--  https://github.com/ISMRM/rrsg/raw/master/challenges/challenge_01/rawdata_brain_radial_96proj_12ch.h5
Resolving github.com (github.com)... 140.82.121.4
Connecting to github.com (github.com)|140.82.121.4|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://raw.githubusercontent.com/ISMRM/rrsg/master/challenges/challenge_01/rawdata_brain_radial_96proj_12ch.h5 [following]
--2022-06-16 20:56:00--  https://raw.githubusercontent.com/ISMRM/rrsg/master/challenges/challenge_01/rawdata_brain_radial_96proj_12ch.h5
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.111.133, 185.199.109.133, 185.199.110.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.111.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5310560 (5.1M) [application/octet-stream]
Saving to: ‘rawdata_brain_radial_96proj_12ch.h5’

rawdata_brain_radia 100%[===================&gt;]   5.06M  10.8MB/s    in 0.5s

2022-06-16 20:56:01 (10.8 MB/s) - ‘rawdata_brain_radial_96proj_12ch.h5’ saved [5310560/5310560]

</pre></div></div>
</div>
<p>This dataset contains 96 radial projections of raw <em>k</em>-space data, acquired with a 12-channel coil array and corresponding to a 300x300 image. The data is stored in a HDF5 file, which we can read using <a class="reference external" href="https://www.h5py.org/">h5py</a>. The downloaded file also has the sampling locations or <em>k</em>-space trajectory, so we do not need to calculate it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">'rawdata_brain_radial_96proj_12ch.h5'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">kspace</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">'rawdata'</span><span class="p">][()]</span>
  <span class="n">trajectory</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">'trajectory'</span><span class="p">][()]</span>

<span class="n">image_shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"kspace shape:"</span><span class="p">,</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"trajectory shape:"</span><span class="p">,</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
kspace shape: (1, 512, 96, 12)
trajectory shape: (3, 512, 96)
</pre></div></div>
</div>
<p>The <em>k</em>-space data is stored with shape <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">samples,</span> <span class="pre">views,</span> <span class="pre">coils]</span></code>, where <code class="docutils literal notranslate"><span class="pre">samples</span></code> is the number of samples per spoke (512), <code class="docutils literal notranslate"><span class="pre">views</span></code> is the number of radial spokes (96) and <code class="docutils literal notranslate"><span class="pre">coils</span></code> is the number of coils (12). TFMRI organizes data slightly differently.</p>
<ul class="simple">
<li><p>Firstly, the singleton dimension is irrelevant and not needed.</p></li>
<li><p>Secondly, the dimension order is reversed. Generally, “outer” dimensions (e.g., coils) appear to the left, and “inner” dimensions (e.g., samples within a view) appear to the right. This results in a more accurate alignment of our conceptual understanding of the different dimensions and their underlying memory representation. TensorFlow tensors, like NumPy arrays, use a row-major memory layout, meaning that the elements of the rightmost dimension are stored contiguously in memory.</p></li>
<li><p>Finally, the different encoding dimensions (<code class="docutils literal notranslate"><span class="pre">samples</span></code>, <code class="docutils literal notranslate"><span class="pre">views</span></code>) typically carry no special meaning in non-Cartesian image reconstruction. Therefore, we flatten them into a single dimension.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the first singleton dimension.</span>
<span class="c1"># [1, samples, views, coils] -&gt; [samples, views, coils]</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Reverse the order of the dimensions.</span>
<span class="c1"># [samples, views, coils] -&gt; [coils, views, samples]</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">kspace</span><span class="p">)</span>

<span class="c1"># Flatten the encoding dimensions.</span>
<span class="c1"># [coils, views, samples] -&gt; [coils, views * samples]</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-06-16 20:56:03.553555: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:03.558517: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:03.558654: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:03.559518: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-06-16 20:56:03.560596: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:03.560733: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:03.560813: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:04.006121: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:04.006264: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:04.006367: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-06-16 20:56:04.006458: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1532] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 14239 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 3080 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.6
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">trajectory</span></code> array is stored with shape <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">samples,</span> <span class="pre">views]</span></code>. As with the <code class="docutils literal notranslate"><span class="pre">kspace</span></code> array, we reverse the order and flatten the <code class="docutils literal notranslate"><span class="pre">samples</span></code> and <code class="docutils literal notranslate"><span class="pre">views</span></code> dimensions. Additionally we need to apply the following changes:</p>
<ul class="simple">
<li><p>The array represents a 3D trajectory but the image has a dimensionality, or <code class="docutils literal notranslate"><span class="pre">rank</span></code>, of 2. The last element along the innermost dimension contains only zeros and is not needed.</p></li>
<li><p>TFMRI expects the sampling coordinates in radians/pixel, i.e. in the range <span class="math notranslate nohighlight">\([-\pi, \pi]\)</span>. However, the trajectory is provided in units of 1/FOV, i.e., in the range <span class="math notranslate nohighlight">\([-150, 150]\)</span>, so we need to convert the units.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reverse the order of the dimensions.</span>
<span class="c1"># [3, samples, views] -&gt; [views, samples, 3]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>

<span class="c1"># Flatten the encoding dimensions.</span>
<span class="c1"># [views, samples, 3] -&gt; [views * samples, 3]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1"># Remove the last element along the rightmost dimension, which contains only</span>
<span class="c1"># zeros and is not necessary for 2D imaging.</span>
<span class="c1"># [views * samples, 3] -&gt; [views * samples, rank]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Convert units from 1/FOV to rad/px.</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">image_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># We only do this so that images display in the correct orientation later.</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
</pre></div>
</div>
</div>
<p>You should now have a <code class="docutils literal notranslate"><span class="pre">kspace</span></code> array with shape <code class="docutils literal notranslate"><span class="pre">[coils,</span> <span class="pre">views</span> <span class="pre">*</span> <span class="pre">samples]</span></code> and a <code class="docutils literal notranslate"><span class="pre">trajectory</span></code> array with shape <code class="docutils literal notranslate"><span class="pre">[views</span> <span class="pre">*</span> <span class="pre">samples,</span> <span class="pre">rank]</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"kspace shape:"</span><span class="p">,</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"trajectory shape:"</span><span class="p">,</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
kspace shape: (12, 49152)
trajectory shape: (49152, 2)
</pre></div></div>
</div>
<p>Let’s visualize the trajectory:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_trajectory_2d</span><span class="p">(</span><span class="n">trajectory</span><span class="p">):</span>
  <span class="sd">"""Plots a 2D trajectory.</span>

<span class="sd">  Args:</span>
<span class="sd">    trajectory: An array of shape `[views, samples, 2]` containing the</span>
<span class="sd">      trajectory.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `matplotlib.collections.LineCollection` object.</span>
<span class="sd">  """</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>

  <span class="c1"># Create a line collection and add it to axis.</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="n">mcol</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

  <span class="c1"># Add colorbar.</span>
  <span class="n">cb_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
  <span class="n">cb_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'View index'</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">lines</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_trajectory_2d</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_20_0.png" src="../../../_images/tutorials_recon_cg_sense_20_0.png"/>
</div>
</div>
<p>As you can see, it consists of a series of 96 uniformly spaced, sequentially acquired radial spokes extending to the edges of <em>k</em>-space (<span class="math notranslate nohighlight">\(\pi\)</span>).</p>
</section>
<section id="Compute-density-compensation-weights">
<h2>Compute density compensation weights<a class="headerlink" href="#Compute-density-compensation-weights" title="Permalink to this headline">#</a></h2>
<p>Non-Cartesian trajectories do not usually sample <em>k</em>-space uniformly. It’s obvious from the figure above that the center of <em>k</em>-space is much more densely sampled than its edges.</p>
<p>It can be useful to explicitly account for this during image reconstruction. In order to do that, we need to estimate the sampling density of the trajectory. TFMRI provides several ways to obtain this estimate. The most flexible is <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/sampling/estimate_density">tfmri.sampling.estimate_density</a>, which works for arbitrary trajectories.</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/sampling">tfmri.sampling</a> module also contains other operators to compute trajectories and densities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">density</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">estimate_density</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"density shape:"</span><span class="p">,</span> <span class="n">density</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
density shape: (49152,)
</pre></div></div>
</div>
</section>
<section id="Perform-zero-filled-reconstruction">
<h2>Perform zero-filled reconstruction<a class="headerlink" href="#Perform-zero-filled-reconstruction" title="Permalink to this headline">#</a></h2>
<p>We are now ready to perform a basic zero-filled reconstruction. The easiest way to do this with TensorFlow MRI is using the function <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/recon/adjoint">tfmri.recon.adjoint</a>.</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/recon">tfmri.recon</a> module has several high-level interfaces for image reconstruction. The <code class="docutils literal notranslate"><span class="pre">adjoint</span></code> interface performs reconstruction via application of the adjoint MRI linear operator, which is constructed internally. See <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/linalg/LinearOperatorMRI">tfmri.linalg.LinearOperatorMRI</a> for more details on this operator.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform image reconstruction. For non-Cartesian reconstruction, we need to</span>
<span class="c1"># provide the k-space data, the shape of the output image, the trajectory and,</span>
<span class="c1"># optionally, the sampling density.</span>
<span class="n">zf_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"zf_images shape:"</span><span class="p">,</span> <span class="n">zf_images</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
zf_images shape: (12, 300, 300)
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tfmri.recon.adjoint</span></code> supports batches of inputs. In addition, the batch shapes of all inputs are broadcasted to obtain the output batch shape. In this case, the coil dimension of <code class="docutils literal notranslate"><span class="pre">kspace</span></code> was interpreted as a batch dimension (multicoil reconstruction is only triggered when <code class="docutils literal notranslate"><span class="pre">sensitivities</span></code> are specified). <code class="docutils literal notranslate"><span class="pre">trajectory</span></code> and <code class="docutils literal notranslate"><span class="pre">density</span></code>, which have scalar batch shapes, were broadcasted to the same shape and all coils were reconstructed in parallel. The sample principles would apply if
reconstructing multiple images with different trajectories.</p>
<blockquote>
<div><p>ℹ️ Many TFMRI operators support batches of inputs. Batch dimensions are always leading.</p>
</div></blockquote>
<blockquote>
<div><p>ℹ️ TensorFlow broadcasting semantics are similar to those of NumPy. Learn more about broadcasting <a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html">here</a>.</p>
</div></blockquote>
<p>Let’s have a look at the reconstructed images:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_tiled_images</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

  <span class="n">artists</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">index</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
    <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'off'</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">artists</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zf_images</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Zero-filled individual coil images'</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_27_0.png" src="../../../_images/tutorials_recon_cg_sense_27_0.png"/>
</div>
</div>
<p>Finally, let’s combine the individual coil images into our final reconstruction. TFMRI provides a very simple function <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/coils/combine_coils">tfmri.coils.combine_coils</a> to perform coil combination via the sum-of-squares method. If coil sensitivity estimates are available, it can also be used to perform adaptive combination.</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/coils">tfmri.coils</a> module contains several utilities to operate with coil arrays.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine all coils to create the final zero-filled reconstruction.</span>
<span class="n">zf_image</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">combine_coils</span><span class="p">(</span><span class="n">zf_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
  <span class="n">artist</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">'k'</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'off'</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">artist</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zf_image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Zero-filled reconstruction'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_30_0.png" src="../../../_images/tutorials_recon_cg_sense_30_0.png"/>
</div>
</div>
</section>
<section id="Compute-coil-sensitivity-maps">
<h2>Compute coil sensitivity maps<a class="headerlink" href="#Compute-coil-sensitivity-maps" title="Permalink to this headline">#</a></h2>
<p>The zero-filled image has visible artefact because the <em>k</em>-space sampling rate is below the Nyquist rate. Information from multiple coils can be used more effectively to address this problem, by performing a SENSE reconstruction.</p>
<p>First we need to obtain the coil sensitivity maps. These can be estimated from the individual coil images. A low-resolution estimate of the images is suitable for this purpose and is easy to obtain, assuming the central part of <em>k</em>-space is sufficiently sampled.</p>
<p>To obtain the low resolution image estimates, we will first apply a low-pass filter to the <em>k</em>-space data. We will be using <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/signal/hann">tfmri.signal.hann</a> and <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/signal/filter_kspace">tfmri.signal.filter_kspace</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First let's filter the *k*-space data with a Hann window. We will apply the</span>
<span class="c1"># window to the central 20% of k-space (determined by the factor 5 below), the</span>
<span class="c1"># remaining 80% is filtered out completely.</span>
<span class="n">filter_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># Let's plot the effect of our filter.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">filter_fn</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Frequency (rad/px)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Filter amplitude'</span><span class="p">)</span>

<span class="c1"># Finally, apply the filter to the k-space data.</span>
<span class="n">filtered_kspace</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filter_kspace</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span>
                                             <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                             <span class="n">filter_fn</span><span class="o">=</span><span class="n">filter_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_32_0.png" src="../../../_images/tutorials_recon_cg_sense_32_0.png"/>
</div>
</div>
<p>We can now reconstruct the images from the filtered <em>k</em>-space data as described in <a class="reference external" href="#perform-zero-filled-reconstruction">Perform zero-filled reconstruction</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low_res_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">filtered_kspace</span><span class="p">,</span>
                                     <span class="n">image_shape</span><span class="p">,</span>
                                     <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                     <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">low_res_images</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Low-resolution images'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_34_0.png" src="../../../_images/tutorials_recon_cg_sense_34_0.png"/>
</div>
</div>
<p>Let’s now use these images to obtain the coil sensitivity maps. We will use Walsh’s method, one of the methods implemented in <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/coils/estimate_sensitivities">tfmri.coils.estimate_sensitivities</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sensitivities</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">estimate_sensitivities</span><span class="p">(</span>
    <span class="n">low_res_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'walsh'</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sensitivities</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Coil sensitivities'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-06-16 20:56:07.292315: I tensorflow/stream_executor/cuda/cuda_dnn.cc:384] Loaded cuDNN version 8101
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_36_1.png" src="../../../_images/tutorials_recon_cg_sense_36_1.png"/>
</div>
</div>
</section>
<section id="Perform-CG-SENSE-reconstruction">
<h2>Perform CG-SENSE reconstruction<a class="headerlink" href="#Perform-CG-SENSE-reconstruction" title="Permalink to this headline">#</a></h2>
<p>We are finally ready to perform the SENSE reconstruction! We will be using another of the high-level interfaces in <code class="docutils literal notranslate"><span class="pre">tfmri.recon</span></code>. In this case, we will use <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/recon/least_squares">tfmri.recon.least_squares</a>. This interface can be used for image reconstruction methods that arise from a least-squares formulation, like CG-SENSE. Internally, this function will create a
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/linalg/LinearOperatorMRI">tfmri.linalg.LinearOperatorMRI</a> and solve the linear system using <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/linalg/conjugate_gradient">tfmri.linalg.conjugate_gradient</a>.</p>
<p>Usage is similar to <code class="docutils literal notranslate"><span class="pre">tfmri.recon.adjoint</span></code>, so let’s have a look:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                  <span class="c1"># Provide trajectory.</span>
                                  <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                  <span class="c1"># Density is optional! But it might speed up</span>
                                  <span class="c1"># convergence.</span>
                                  <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
                                  <span class="c1"># Provide the coil sensitivities. Otherwise</span>
                                  <span class="c1"># this is just an iterative inverse NUFFT.</span>
                                  <span class="n">sensitivities</span><span class="o">=</span><span class="n">sensitivities</span><span class="p">,</span>
                                  <span class="c1"># Use conjugate gradient.</span>
                                  <span class="n">optimizer</span><span class="o">=</span><span class="s1">'cg'</span><span class="p">,</span>
                                  <span class="c1"># Pass any additional arguments to the</span>
                                  <span class="c1"># optimizer.</span>
                                  <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                      <span class="s1">'max_iterations'</span><span class="p">:</span> <span class="mi">10</span>
                                  <span class="p">},</span>
                                  <span class="c1"># Filter out the areas of *k*-space outside</span>
                                  <span class="c1"># the support of the trajectory.</span>
                                  <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Reconstructed image'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_39_0.png" src="../../../_images/tutorials_recon_cg_sense_39_0.png"/>
</div>
</div>
<section id="Add-Tikhonov-regularization">
<h3>Add Tikhonov regularization<a class="headerlink" href="#Add-Tikhonov-regularization" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tfmri.recon.least_squares</span></code> supports regularization. Tikhonov regularization can help improve the conditioning of a linear system. In its simplest form, it simply favors solutions with a low L2 norm, which can help to reduce the amount of noise.</p>
<p>A regularizer can be specified using the <code class="docutils literal notranslate"><span class="pre">regularizer</span></code> argument of <code class="docutils literal notranslate"><span class="pre">least_squares</span></code>. This object depends on the type of problem but in most circumstances it should be a <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/convex/ConvexFunction">tfmri.convex.ConvexFunction</a>. For Tikhonov regularization, we can use <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/convex/ConvexFunctionTikhonov">tfmri.convex.ConvexFunctionTikhonov</a>.</p>
<blockquote>
<div><p>ℹ️ The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/convex">tfmri.convex</a> module contains many more operators for convex optimization.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the regularizer. We specify the `scale` argument (the regularization</span>
<span class="c1"># factor) and the input dtype.</span>
<span class="n">regularizer</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">convex</span><span class="o">.</span><span class="n">ConvexFunctionTikhonov</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>

<span class="n">reg_image</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                      <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                      <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
                                      <span class="n">sensitivities</span><span class="o">=</span><span class="n">sensitivities</span><span class="p">,</span>
                                      <span class="n">regularizer</span><span class="o">=</span><span class="n">regularizer</span><span class="p">,</span>
                                      <span class="n">optimizer</span><span class="o">=</span><span class="s1">'cg'</span><span class="p">,</span>
                                      <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                          <span class="s1">'max_iterations'</span><span class="p">:</span> <span class="mi">10</span>
                                      <span class="p">},</span>
                                      <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">reg_image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Reconstructed image (with Tikhonov regularization)'</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_41_0.png" src="../../../_images/tutorials_recon_cg_sense_41_0.png"/>
</div>
</div>
</section>
</section>
<section id="Consolidate-previous-steps">
<h2>Consolidate previous steps<a class="headerlink" href="#Consolidate-previous-steps" title="Permalink to this headline">#</a></h2>
<p>Let’s put together our entire reconstruction pipeline in a single function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconstruct_cgsense</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">,</span>
                        <span class="n">tikhonov_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">"""Reconstructs an MR image using CG-SENSE.</span>

<span class="sd">  Sampling density and coil sensitivities are estimated automatically.</span>

<span class="sd">  Args:</span>
<span class="sd">    kspace: A `tf.Tensor` of shape `[coils, views * samples]` containing the</span>
<span class="sd">      measured k-space data.</span>
<span class="sd">    image_shape: A `list` or `tf.TensorShape` specifying the shape of the image</span>
<span class="sd">      to reconstruct.</span>
<span class="sd">    trajectory: A `tf.Tensor` of shape `[views * samples, rank]` containing the</span>
<span class="sd">      sampling locations.</span>
<span class="sd">    tikhonov_parameter: A `float` specifying the Tikhonov regularization</span>
<span class="sd">      parameter. If `None`, no regularization is applied.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `tf.Tensor` of shape `image_shape` containing the reconstructed image.</span>
<span class="sd">  """</span>
  <span class="c1"># Estimate the sampling density.</span>
  <span class="n">density</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">estimate_density</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">)</span>

  <span class="c1"># Low-pass filtering of the k-space data.</span>
  <span class="n">filtered_kspace</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filter_kspace</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span>
                                               <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                               <span class="n">filter_fn</span><span class="o">=</span><span class="n">filter_fn</span><span class="p">)</span>

  <span class="c1"># Reconstruct low resolution estimates.</span>
  <span class="n">low_res_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">filtered_kspace</span><span class="p">,</span>
                                       <span class="n">image_shape</span><span class="p">,</span>
                                       <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                       <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

  <span class="c1"># Estimate the coil sensitivities.</span>
  <span class="n">sensitivities</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">estimate_sensitivities</span><span class="p">(</span>
      <span class="n">low_res_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'walsh'</span><span class="p">)</span>

  <span class="c1"># Create regularizer.</span>
  <span class="k">if</span> <span class="n">tikhonov_parameter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">regularizer</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">convex</span><span class="o">.</span><span class="n">ConvexFunctionTikhonov</span><span class="p">(</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">tikhonov_parameter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">regularizer</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="c1"># Perform the reconstruction.</span>
  <span class="k">return</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                   <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                   <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
                                   <span class="n">sensitivities</span><span class="o">=</span><span class="n">sensitivities</span><span class="p">,</span>
                                   <span class="n">regularizer</span><span class="o">=</span><span class="n">regularizer</span><span class="p">,</span>
                                   <span class="n">optimizer</span><span class="o">=</span><span class="s1">'cg'</span><span class="p">,</span>
                                   <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                       <span class="s1">'max_iterations'</span><span class="p">:</span> <span class="mi">10</span>
                                   <span class="p">},</span>
                                   <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To make things more interesting, let’s test it with some new data! We’ll use a cardiac dataset which was also provided by the ISMRM Reproducibility Challenge 1.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">heart_data_filename</span> <span class="o">=</span> <span class="s1">'rawdata_heart_radial_55proj_34ch.h5'</span>
<span class="n">heart_data_url</span> <span class="o">=</span> <span class="s2">"https://github.com/ISMRM/rrsg/raw/master/challenges/challenge_01/rawdata_heart_radial_55proj_34ch.h5"</span>
<span class="o">!</span>wget -O <span class="o">{</span>heart_data_filename<span class="o">}</span> <span class="o">{</span>heart_data_url<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2022-06-16 20:56:15--  https://github.com/ISMRM/rrsg/raw/master/challenges/challenge_01/rawdata_heart_radial_55proj_34ch.h5
Resolving github.com (github.com)... 140.82.121.4
Connecting to github.com (github.com)|140.82.121.4|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://raw.githubusercontent.com/ISMRM/rrsg/master/challenges/challenge_01/rawdata_heart_radial_55proj_34ch.h5 [following]
--2022-06-16 20:56:16--  https://raw.githubusercontent.com/ISMRM/rrsg/master/challenges/challenge_01/rawdata_heart_radial_55proj_34ch.h5
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.111.133, 185.199.109.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5000544 (4.8M) [application/octet-stream]
Saving to: ‘rawdata_heart_radial_55proj_34ch.h5’

rawdata_heart_radia 100%[===================&gt;]   4.77M  12.3MB/s    in 0.4s

2022-06-16 20:56:17 (12.3 MB/s) - ‘rawdata_heart_radial_55proj_34ch.h5’ saved [5000544/5000544]

</pre></div></div>
</div>
<p>Let’s read the data and process it in the same way as before:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">'rawdata_heart_radial_55proj_34ch.h5'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">kspace</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">'rawdata'</span><span class="p">][()]</span>
  <span class="n">trajectory</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">'trajectory'</span><span class="p">][()]</span>

<span class="n">image_shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>

<span class="c1"># Convert k-space to TFMRI format.</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">kspace</span><span class="p">)</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Convert trajectory to TFMRI format.</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">image_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now perform the reconstruction:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">reconstruct_cgsense</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">,</span>
                            <span class="n">tikhonov_parameter</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Reconstructed image'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/tutorials_recon_cg_sense_50_0.png" src="../../../_images/tutorials_recon_cg_sense_50_0.png"/>
</div>
</div>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this headline">#</a></h2>
<p>Congratulations! You performed a non-Cartesian CG-SENSE reconstruction using TensorFlow MRI. The code used in this notebook works for any dataset and trajectory. It also works for 3D imaging. Feel free to try with your own data!</p>
<p>For more information about the functions used in this tutorial, check out the <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/">API documentation</a>. For more examples of using TensorFlow MRI, check out the <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/tutorials/">tutorials</a>.</p>
<section id="Let-us-know!">
<h3>Let us know!<a class="headerlink" href="#Let-us-know!" title="Permalink to this headline">#</a></h3>
<p>Please tell us what you think about this tutorial and about TensorFlow MRI. We would like to hear what you liked and how we can improve. You can reach us on <a class="reference external" href="https://github.com/mrphys/tensorflow-mri/issues/new">GitHub</a> or at <a class="reference external" href="mailto:tensorflow.mri%40gmail.com">tensorflow<span>.</span>mri<span>@</span>gmail<span>.</span>com</a>.</p>
<section id="Copyright-2022-University-College-London.">
<h4>Copyright 2022 University College London.<a class="headerlink" href="#Copyright-2022-University-College-London." title="Permalink to this headline">#</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../../api_docs/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">TensorFlow MRI API documentation</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Image reconstruction</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021 University College London
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Image reconstruction with CG-SENSE</a><ul>
<li><a class="reference internal" href="#Set-up-TensorFlow-MRI">Set up TensorFlow MRI</a><ul>
<li><a class="reference internal" href="#Using-a-GPU">Using a GPU</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Prepare-the-data">Prepare the data</a></li>
<li><a class="reference internal" href="#Compute-density-compensation-weights">Compute density compensation weights</a></li>
<li><a class="reference internal" href="#Perform-zero-filled-reconstruction">Perform zero-filled reconstruction</a></li>
<li><a class="reference internal" href="#Compute-coil-sensitivity-maps">Compute coil sensitivity maps</a></li>
<li><a class="reference internal" href="#Perform-CG-SENSE-reconstruction">Perform CG-SENSE reconstruction</a><ul>
<li><a class="reference internal" href="#Add-Tikhonov-regularization">Add Tikhonov regularization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Consolidate-previous-steps">Consolidate previous steps</a></li>
<li><a class="reference internal" href="#Conclusion">Conclusion</a><ul>
<li><a class="reference internal" href="#Let-us-know!">Let us know!</a><ul>
<li><a class="reference internal" href="#Copyright-2022-University-College-London.">Copyright 2022 University College London.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>