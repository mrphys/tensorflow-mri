
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Image reconstruction with CG-SENSE &#8212; TensorFlow MRI Documentation</title>
    
    <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" />
    
    <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://mrphys.github.io/tensorflow-mri/tutorials/recon/cg_sense.html" />
    <link rel="shortcut icon" href="../../../_static/tfmri_icon.svg"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Image reconstruction with Compressed Sensing (2D and 2D+time)" href="../radial_CS/" />
    <link rel="prev" title="We need to read the raw data from the scanner (In siemens this is stored as a .dat file)" href="../ProcessingRFHdata/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/tfmri_logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption" role="heading">
 <span class="caption-text">
  Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/">
   Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/install/">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/nufft/">
   Non-uniform FFT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/linalg/">
   Linear algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/optim/">
   Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/recon/">
   MRI reconstruction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/contribute/">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../guide/faq/">
   FAQ
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../">
   Tutorials
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../segment/">
   Segmentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../segment/2d_segmentation/">
     Set up TensorFlow MRi
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../">
   Image reconstruction
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../partialFourier/">
     PARTIAL-FOURIER (2D+t Cartesian k-space)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cartesianGRAPPA/">
     CARTESIAN GRAPPA (2D+t Cartesian k-space)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cartesianSENSE/">
     CARTESIAN SENSE (2D+t Cartesian k-space)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nufftTutorial/">
     Gridding and Non-uniform fast Fourier transform (NUFFT)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ProcessingRFHdata/">
     PRE-PROCESSING TRIGGERED CINE DATASET (with GRAPPA and PF)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Image reconstruction with CG-SENSE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../radial_CS/">
     Image reconstruction with Compressed Sensing (2D and 2D+time)
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  API Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../api_docs/">
   API documentation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/">
   tfmri
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/broadcast_dynamic_shapes/">
     tensorflow_mri.broadcast_dynamic_shapes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/broadcast_static_shapes/">
     tensorflow_mri.broadcast_static_shapes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/cartesian_product/">
     tensorflow_mri.cartesian_product
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/central_crop/">
     tensorflow_mri.central_crop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/meshgrid/">
     tensorflow_mri.meshgrid
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/ravel_multi_index/">
     tensorflow_mri.ravel_multi_index
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/resize_with_crop_or_pad/">
     tensorflow_mri.resize_with_crop_or_pad
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/scale_by_min_max/">
     tensorflow_mri.scale_by_min_max
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/unravel_index/">
     tensorflow_mri.unravel_index
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/array/">
   tfmri.array
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/array/update_tensor/">
     tfmri.array.update_tensor
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/callbacks/">
   tfmri.callbacks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/callbacks/TensorBoardImages/">
     tfmri.callbacks.TensorBoardImages
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/coils/">
   tfmri.coils
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/coils/CoilCompressorSVD/">
     tfmri.coils.CoilCompressorSVD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/coils/combine_coils/">
     tfmri.coils.combine_coils
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/coils/compress_coils/">
     tfmri.coils.compress_coils
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/coils/estimate_sensitivities/">
     tfmri.coils.estimate_sensitivities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/convex/">
   tfmri.convex
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunction/">
     tfmri.convex.ConvexFunction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionAffineMappingComposition/">
     tfmri.convex.ConvexFunctionAffineMappingComposition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionIndicatorBall/">
     tfmri.convex.ConvexFunctionIndicatorBall
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionIndicatorL1Ball/">
     tfmri.convex.ConvexFunctionIndicatorL1Ball
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionIndicatorL2Ball/">
     tfmri.convex.ConvexFunctionIndicatorL2Ball
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL1Norm/">
     tfmri.convex.ConvexFunctionL1Norm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL1Wavelet/">
     tfmri.convex.ConvexFunctionL1Wavelet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL2Norm/">
     tfmri.convex.ConvexFunctionL2Norm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionL2NormSquared/">
     tfmri.convex.ConvexFunctionL2NormSquared
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionLeastSquares/">
     tfmri.convex.ConvexFunctionLeastSquares
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionLinearOperatorComposition/">
     tfmri.convex.ConvexFunctionLinearOperatorComposition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionNorm/">
     tfmri.convex.ConvexFunctionNorm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionQuadratic/">
     tfmri.convex.ConvexFunctionQuadratic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionTikhonov/">
     tfmri.convex.ConvexFunctionTikhonov
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/ConvexFunctionTotalVariation/">
     tfmri.convex.ConvexFunctionTotalVariation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/convex/admm_minimize/">
     tfmri.convex.admm_minimize
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/image/">
   tfmri.image
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/extract_glimpses/">
     tfmri.image.extract_glimpses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/gmsd/">
     tfmri.image.gmsd
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/gmsd2d/">
     tfmri.image.gmsd2d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/gmsd3d/">
     tfmri.image.gmsd3d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/gradient_magnitude/">
     tfmri.image.gradient_magnitude
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/image_gradients/">
     tfmri.image.image_gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/phantom/">
     tfmri.image.phantom
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/psnr/">
     tfmri.image.psnr
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/psnr2d/">
     tfmri.image.psnr2d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/psnr3d/">
     tfmri.image.psnr3d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/ssim/">
     tfmri.image.ssim
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/ssim2d/">
     tfmri.image.ssim2d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/ssim2d_multiscale/">
     tfmri.image.ssim2d_multiscale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/ssim3d/">
     tfmri.image.ssim3d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/ssim3d_multiscale/">
     tfmri.image.ssim3d_multiscale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/ssim_multiscale/">
     tfmri.image.ssim_multiscale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/image/total_variation/">
     tfmri.image.total_variation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/initializers/">
   tfmri.initializers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/GlorotNormal/">
     tfmri.initializers.GlorotNormal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/GlorotUniform/">
     tfmri.initializers.GlorotUniform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/HeNormal/">
     tfmri.initializers.HeNormal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/HeUniform/">
     tfmri.initializers.HeUniform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/LecunNormal/">
     tfmri.initializers.LecunNormal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/LecunUniform/">
     tfmri.initializers.LecunUniform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/initializers/VarianceScaling/">
     tfmri.initializers.VarianceScaling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/io/">
   tfmri.io
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/io/encode_gif/">
     tfmri.io.encode_gif
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/io/parse_twix/">
     tfmri.io.parse_twix
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/layers/">
   tfmri.layers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/AveragePooling1D/">
     tfmri.layers.AveragePooling1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/AveragePooling2D/">
     tfmri.layers.AveragePooling2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/AveragePooling3D/">
     tfmri.layers.AveragePooling3D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/Conv1D/">
     tfmri.layers.Conv1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/Conv2D/">
     tfmri.layers.Conv2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/Conv3D/">
     tfmri.layers.Conv3D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/ConvBlock/">
     tfmri.layers.ConvBlock
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/DWT1D/">
     tfmri.layers.DWT1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/DWT2D/">
     tfmri.layers.DWT2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/DWT3D/">
     tfmri.layers.DWT3D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/IDWT1D/">
     tfmri.layers.IDWT1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/IDWT2D/">
     tfmri.layers.IDWT2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/IDWT3D/">
     tfmri.layers.IDWT3D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/MaxPooling1D/">
     tfmri.layers.MaxPooling1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/MaxPooling2D/">
     tfmri.layers.MaxPooling2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/MaxPooling3D/">
     tfmri.layers.MaxPooling3D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/layers/UNet/">
     tfmri.layers.UNet
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/linalg/">
   tfmri.linalg
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperator/">
     tfmri.linalg.LinearOperator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorAddition/">
     tfmri.linalg.LinearOperatorAddition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorAdjoint/">
     tfmri.linalg.LinearOperatorAdjoint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorComposition/">
     tfmri.linalg.LinearOperatorComposition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorDiag/">
     tfmri.linalg.LinearOperatorDiag
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorFiniteDifference/">
     tfmri.linalg.LinearOperatorFiniteDifference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorGramMRI/">
     tfmri.linalg.LinearOperatorGramMRI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorGramMatrix/">
     tfmri.linalg.LinearOperatorGramMatrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorGramNUFFT/">
     tfmri.linalg.LinearOperatorGramNUFFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorMRI/">
     tfmri.linalg.LinearOperatorMRI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorNUFFT/">
     tfmri.linalg.LinearOperatorNUFFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorScaledIdentity/">
     tfmri.linalg.LinearOperatorScaledIdentity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/LinearOperatorWavelet/">
     tfmri.linalg.LinearOperatorWavelet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/linalg/conjugate_gradient/">
     tfmri.linalg.conjugate_gradient
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/losses/">
   tfmri.losses
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/ConfusionLoss/">
     tfmri.losses.ConfusionLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/F1Loss/">
     tfmri.losses.F1Loss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/FocalTverskyLoss/">
     tfmri.losses.FocalTverskyLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/IoULoss/">
     tfmri.losses.IoULoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/SSIMLoss/">
     tfmri.losses.SSIMLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/SSIMMultiscaleLoss/">
     tfmri.losses.SSIMMultiscaleLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/TverskyLoss/">
     tfmri.losses.TverskyLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/ssim_loss/">
     tfmri.losses.ssim_loss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/losses/ssim_multiscale_loss/">
     tfmri.losses.ssim_multiscale_loss
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/math/">
   tfmri.math
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/block_soft_threshold/">
     tfmri.math.block_soft_threshold
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/extract_from_complex/">
     tfmri.math.extract_from_complex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/indicator_ball/">
     tfmri.math.indicator_ball
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/indicator_box/">
     tfmri.math.indicator_box
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/indicator_simplex/">
     tfmri.math.indicator_simplex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/make_val_and_grad_fn/">
     tfmri.math.make_val_and_grad_fn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/normalize_no_nan/">
     tfmri.math.normalize_no_nan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/project_onto_ball/">
     tfmri.math.project_onto_ball
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/project_onto_box/">
     tfmri.math.project_onto_box
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/project_onto_simplex/">
     tfmri.math.project_onto_simplex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/shrinkage/">
     tfmri.math.shrinkage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/math/soft_threshold/">
     tfmri.math.soft_threshold
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/metrics/">
   tfmri.metrics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/Accuracy/">
     tfmri.metrics.Accuracy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/ConfusionMetric/">
     tfmri.metrics.ConfusionMetric
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/F1Score/">
     tfmri.metrics.F1Score
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/FBetaScore/">
     tfmri.metrics.FBetaScore
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/IoU/">
     tfmri.metrics.IoU
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/NegativePredictiveValue/">
     tfmri.metrics.NegativePredictiveValue
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/PSNR/">
     tfmri.metrics.PSNR
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/PositivePredictiveValue/">
     tfmri.metrics.PositivePredictiveValue
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/SSIM/">
     tfmri.metrics.SSIM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/SSIMMultiscale/">
     tfmri.metrics.SSIMMultiscale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/TrueNegativeRate/">
     tfmri.metrics.TrueNegativeRate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/TruePositiveRate/">
     tfmri.metrics.TruePositiveRate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/metrics/TverskyIndex/">
     tfmri.metrics.TverskyIndex
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/models/">
   tfmri.models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/models/ConvBlock1D/">
     tfmri.models.ConvBlock1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/models/ConvBlock2D/">
     tfmri.models.ConvBlock2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/models/ConvBlock3D/">
     tfmri.models.ConvBlock3D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/models/UNet1D/">
     tfmri.models.UNet1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/models/UNet2D/">
     tfmri.models.UNet2D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/models/UNet3D/">
     tfmri.models.UNet3D
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/optimize/">
   tfmri.optimize
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/optimize/gradient_descent/">
     tfmri.optimize.gradient_descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/optimize/lbfgs_minimize/">
     tfmri.optimize.lbfgs_minimize
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/plot/">
   tfmri.plot
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/plot/close/">
     tfmri.plot.close
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/plot/image_sequence/">
     tfmri.plot.image_sequence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/plot/show/">
     tfmri.plot.show
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/plot/tiled_image/">
     tfmri.plot.tiled_image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/plot/tiled_image_sequence/">
     tfmri.plot.tiled_image_sequence
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/recon/">
   tfmri.recon
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/recon/adjoint/">
     tfmri.recon.adjoint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/recon/grappa/">
     tfmri.recon.grappa
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/recon/least_squares/">
     tfmri.recon.least_squares
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/recon/partial_fourier/">
     tfmri.recon.partial_fourier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/recon/sense/">
     tfmri.recon.sense
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/sampling/">
   tfmri.sampling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/density_grid/">
     tfmri.sampling.density_grid
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/estimate_density/">
     tfmri.sampling.estimate_density
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/estimate_radial_density/">
     tfmri.sampling.estimate_radial_density
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/expand_density/">
     tfmri.sampling.expand_density
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/expand_trajectory/">
     tfmri.sampling.expand_trajectory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/flatten_density/">
     tfmri.sampling.flatten_density
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/flatten_trajectory/">
     tfmri.sampling.flatten_trajectory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/radial_density/">
     tfmri.sampling.radial_density
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/radial_trajectory/">
     tfmri.sampling.radial_trajectory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/radial_waveform/">
     tfmri.sampling.radial_waveform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/random_mask/">
     tfmri.sampling.random_mask
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/sampling/spiral_trajectory/">
     tfmri.sampling.spiral_trajectory
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/signal/">
   tfmri.signal
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/atanfilt/">
     tfmri.signal.atanfilt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/crop_kspace/">
     tfmri.signal.crop_kspace
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/dwt/">
     tfmri.signal.dwt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/fft/">
     tfmri.signal.fft
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/filter_kspace/">
     tfmri.signal.filter_kspace
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/hamming/">
     tfmri.signal.hamming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/hann/">
     tfmri.signal.hann
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/idwt/">
     tfmri.signal.idwt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/ifft/">
     tfmri.signal.ifft
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/max_wavelet_level/">
     tfmri.signal.max_wavelet_level
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/nufft/">
     tfmri.signal.nufft
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/tensor_to_wavelet_coeffs/">
     tfmri.signal.tensor_to_wavelet_coeffs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/wavedec/">
     tfmri.signal.wavedec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/wavelet_coeffs_to_tensor/">
     tfmri.signal.wavelet_coeffs_to_tensor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/signal/waverec/">
     tfmri.signal.waverec
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api_docs/tfmri/summary/">
   tfmri.summary
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api_docs/tfmri/summary/gif/">
     tfmri.summary.gif
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://colab.research.google.com/github/mrphys/tensorflow-mri/blob/master/tools/docs/tutorials/recon/cg_sense.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/mrphys/tensorflow-mri"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/tutorials/recon/cg_sense.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Image reconstruction with CG-SENSE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-tensorflow-mri">
     Set up TensorFlow MRI
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-a-gpu">
       Using a GPU
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-the-data">
     Prepare the data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-density-compensation-weights">
     Compute density compensation weights
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perform-zero-filled-reconstruction">
     Perform zero-filled reconstruction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-coil-sensitivity-maps">
     Compute coil sensitivity maps
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perform-cg-sense-reconstruction">
     Perform CG-SENSE reconstruction
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-tikhonov-regularization">
       Add Tikhonov regularization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consolidate-previous-steps">
     Consolidate previous steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#we-will-also-try-a-2d-t-non-cartesian-sense-example">
   We will also try a 2D+t non-Cartesian SENSE example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     Conclusion
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#let-us-know">
       Let us know!
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Image reconstruction with CG-SENSE</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Image reconstruction with CG-SENSE
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-tensorflow-mri">
     Set up TensorFlow MRI
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-a-gpu">
       Using a GPU
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-the-data">
     Prepare the data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-density-compensation-weights">
     Compute density compensation weights
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perform-zero-filled-reconstruction">
     Perform zero-filled reconstruction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-coil-sensitivity-maps">
     Compute coil sensitivity maps
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perform-cg-sense-reconstruction">
     Perform CG-SENSE reconstruction
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-tikhonov-regularization">
       Add Tikhonov regularization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consolidate-previous-steps">
     Consolidate previous steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#we-will-also-try-a-2d-t-non-cartesian-sense-example">
   We will also try a 2D+t non-Cartesian SENSE example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     Conclusion
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#let-us-know">
       Let us know!
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="image-reconstruction-with-cg-sense">
<h1>Image reconstruction with CG-SENSE<a class="headerlink" href="#image-reconstruction-with-cg-sense" title="Permalink to this headline"></a></h1>
<section id="set-up-tensorflow-mri">
<h2>Set up TensorFlow MRI<a class="headerlink" href="#set-up-tensorflow-mri" title="Permalink to this headline"></a></h2>
<p>If you have not yet installed TensorFlow MRI in your environment, you may do so
now using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install --quiet tensorflow-mri
<span class="c1"># Upgrade Matplotlib. Versions older than 3.5.x may cause an error below.</span>
<span class="o">%</span><span class="k">pip</span> install --quiet --upgrade matplotlib
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.</span>
<span class=" -Color -Color-Yellow">You should consider upgrading via the &#39;/usr/local/bin/python3.8 -m pip install --upgrade pip&#39; command.</span>
Note: you may need to restart the kernel to use updated packages.
<span class=" -Color -Color-Yellow">WARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.</span>
<span class=" -Color -Color-Yellow">You should consider upgrading via the &#39;/usr/local/bin/python3.8 -m pip install --upgrade pip&#39; command.</span>
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<p>Then, import the package into your program to get started:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow_mri</span> <span class="k">as</span> <span class="nn">tfmri</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TensorFlow MRI version:&quot;</span><span class="p">,</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-17 19:22:29.144256: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TensorFlow MRI version: 0.20.0
</pre></div>
</div>
</div>
</div>
<p>We will also need a few additional packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib.collections</span> <span class="k">as</span> <span class="nn">mcol</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</pre></div>
</div>
</div>
</div>
<section id="using-a-gpu">
<h3>Using a GPU<a class="headerlink" href="#using-a-gpu" title="Permalink to this headline"></a></h3>
<p>TensorFlow MRI supports CPU and GPU computation. If there is a GPU available in
your environment and it is visible to TensorFlow, it will be used automatically.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In Google Colab, you can enable GPU computation by clicking on
<strong>Runtime &gt; Change runtime type</strong> and selecting <strong>GPU</strong> under
<strong>Hardware accelerator</strong>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can control whether CPU or GPU is used for a particular operation via
the <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/device"><code class="docutils literal notranslate"><span class="pre">tf.device</span></code></a>
context manager.</p>
</div>
</section>
</section>
<section id="prepare-the-data">
<h2>Prepare the data<a class="headerlink" href="#prepare-the-data" title="Permalink to this headline"></a></h2>
<p>We will be using an example brain dataset from the
<a class="reference external" href="https://ismrm.github.io/rrsg/challenge_one/">ISMRM Reproducibility Challenge 1</a>.
Lets download it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_data_filename</span> <span class="o">=</span> <span class="s1">&#39;rawdata_brain_radial_96proj_12ch.h5&#39;</span>
<span class="n">brain_data_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/ISMRM/rrsg/raw/master/challenges/challenge_01/rawdata_brain_radial_96proj_12ch.h5&quot;</span>
<span class="o">!</span>wget --quiet -O <span class="o">{</span>brain_data_filename<span class="o">}</span> <span class="o">{</span>brain_data_url<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<p>This dataset contains 96 radial projections of raw <em>k</em>-space data, acquired with
a 12-channel coil array and corresponding to a 300x300 image. The data is stored
in a HDF5 file, which we can read using <a class="reference external" href="https://www.h5py.org/">h5py</a>. The
downloaded file also has the sampling locations or <em>k</em>-space trajectory, so we
do not need to calculate it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;rawdata_brain_radial_96proj_12ch.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">kspace</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;rawdata&#39;</span><span class="p">][()]</span>
  <span class="n">trajectory</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">][()]</span>

<span class="n">image_shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kspace shape:&quot;</span><span class="p">,</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trajectory shape:&quot;</span><span class="p">,</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>kspace shape: (1, 512, 96, 12)
trajectory shape: (3, 512, 96)
</pre></div>
</div>
</div>
</div>
<p>The <em>k</em>-space data is stored with shape <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">samples,</span> <span class="pre">views,</span> <span class="pre">coils]</span></code>, where
<code class="docutils literal notranslate"><span class="pre">samples</span></code> is the number of samples per spoke (512), <code class="docutils literal notranslate"><span class="pre">views</span></code> is the number of
radial spokes (96) and <code class="docutils literal notranslate"><span class="pre">coils</span></code> is the number of coils (12). TFMRI organizes data
slightly differently.</p>
<ul class="simple">
<li><p>Firstly, the singleton dimension is irrelevant and not needed.</p></li>
<li><p>Secondly, the dimension order is reversed. Generally, outer dimensions
(e.g., coils) appear to the left, and inner dimensions (e.g., samples within
a view) appear to the right. This results in a more accurate alignment of our
conceptual understanding of the different dimensions and their underlying
memory representation. TensorFlow tensors, like NumPy arrays, use a row-major
memory layout, meaning that the elements of the rightmost dimension are
stored contiguously in memory.</p></li>
<li><p>Finally, the different encoding dimensions (<code class="docutils literal notranslate"><span class="pre">samples</span></code>, <code class="docutils literal notranslate"><span class="pre">views</span></code>) typically
carry no special meaning in non-Cartesian image reconstruction. Therefore,
we flatten them into a single dimension.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the first singleton dimension.</span>
<span class="c1"># [1, samples, views, coils] -&gt; [samples, views, coils]</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Reverse the order of the dimensions.</span>
<span class="c1"># [samples, views, coils] -&gt; [coils, views, samples]</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">kspace</span><span class="p">)</span>

<span class="c1"># Flatten the encoding dimensions.</span>
<span class="c1"># [coils, views, samples] -&gt; [coils, views * samples]</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-17 19:22:44.871405: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:44.876327: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:44.876468: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:44.877197: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-07-17 19:22:44.878023: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:44.878132: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:44.878207: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:45.234675: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:45.234826: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:45.234916: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-07-17 19:22:45.235001: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1532] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 14237 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 3080 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.6
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">trajectory</span></code> array is stored with shape <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">samples,</span> <span class="pre">views]</span></code>. As with the
<code class="docutils literal notranslate"><span class="pre">kspace</span></code> array, we reverse the order and flatten the <code class="docutils literal notranslate"><span class="pre">samples</span></code> and <code class="docutils literal notranslate"><span class="pre">views</span></code>
dimensions. Additionally we need to apply the following changes:</p>
<ul class="simple">
<li><p>The array represents a 3D trajectory but the image has a dimensionality, or
<code class="docutils literal notranslate"><span class="pre">rank</span></code>, of 2. The last element along the innermost dimension contains only
zeros and is not needed.</p></li>
<li><p>TFMRI expects the sampling coordinates in radians/pixel, i.e. in the range
<span class="math notranslate nohighlight">\([-\pi, \pi]\)</span>. However, the trajectory is provided in units of 1/FOV, i.e., in
the range <span class="math notranslate nohighlight">\([-150, 150]\)</span>, so we need to convert the units.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reverse the order of the dimensions.</span>
<span class="c1"># [3, samples, views] -&gt; [views, samples, 3]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>

<span class="c1"># Flatten the encoding dimensions.</span>
<span class="c1"># [views, samples, 3] -&gt; [views * samples, 3]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1"># Remove the last element along the rightmost dimension, which contains only</span>
<span class="c1"># zeros and is not necessary for 2D imaging.</span>
<span class="c1"># [views * samples, 3] -&gt; [views * samples, rank]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Convert units from 1/FOV to rad/px.</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">image_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># We only do this so that images display in the correct orientation later.</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
</pre></div>
</div>
</div>
</div>
<p>You should now have a <code class="docutils literal notranslate"><span class="pre">kspace</span></code> array with shape <code class="docutils literal notranslate"><span class="pre">[coils,</span> <span class="pre">views</span> <span class="pre">*</span> <span class="pre">samples]</span></code> and
a <code class="docutils literal notranslate"><span class="pre">trajectory</span></code> array with shape <code class="docutils literal notranslate"><span class="pre">[views</span> <span class="pre">*</span> <span class="pre">samples,</span> <span class="pre">rank]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kspace shape:&quot;</span><span class="p">,</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trajectory shape:&quot;</span><span class="p">,</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>kspace shape: (12, 49152)
trajectory shape: (49152, 2)
</pre></div>
</div>
</div>
</div>
<p>Lets visualize the trajectory:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_trajectory_2d</span><span class="p">(</span><span class="n">trajectory</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Plots a 2D trajectory.</span>

<span class="sd">  Args:</span>
<span class="sd">    trajectory: An array of shape `[views, samples, 2]` containing the</span>
<span class="sd">      trajectory.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `matplotlib.collections.LineCollection` object.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

  <span class="c1"># Create a line collection and add it to axis.</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="n">mcol</span><span class="o">.</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

  <span class="c1"># Add colorbar.</span>
  <span class="n">cb_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
  <span class="n">cb_ax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;View index&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">lines</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_trajectory_2d</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9486fadef2a1c78c711db41f9401a8e1e73aa70c68331035c09b20b65b6c240c.png" src="../../../_images/9486fadef2a1c78c711db41f9401a8e1e73aa70c68331035c09b20b65b6c240c.png" />
</div>
</div>
<p>As you can see, it consists of a series of 96 uniformly spaced, sequentially
acquired radial spokes extending to the edges of <em>k</em>-space (<span class="math notranslate nohighlight">\(\pi\)</span>).</p>
</section>
<section id="compute-density-compensation-weights">
<h2>Compute density compensation weights<a class="headerlink" href="#compute-density-compensation-weights" title="Permalink to this headline"></a></h2>
<p>Non-Cartesian trajectories do not usually sample <em>k</em>-space uniformly. Its
obvious from the figure above that the center of <em>k</em>-space is much more densely
sampled than its edges.</p>
<p>It can be useful to explicitly account for this during image reconstruction. In
order to do that, we need to estimate the sampling density of the trajectory.
TFMRI provides several ways to obtain this estimate. The most flexible is
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/sampling/estimate_density"><code class="docutils literal notranslate"><span class="pre">tfmri.sampling.estimate_density</span></code></a>,
which works for arbitrary trajectories.</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/sampling"><code class="docutils literal notranslate"><span class="pre">tfmri.sampling</span></code></a>
module also contains other operators to compute trajectories and densities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">density</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">estimate_density</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;density shape:&quot;</span><span class="p">,</span> <span class="n">density</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>density shape: (49152,)
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-zero-filled-reconstruction">
<h2>Perform zero-filled reconstruction<a class="headerlink" href="#perform-zero-filled-reconstruction" title="Permalink to this headline"></a></h2>
<p>We are now ready to perform a basic zero-filled reconstruction. The easiest
way to do this with TensorFlow MRI is using the function
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/recon/adjoint"><code class="docutils literal notranslate"><span class="pre">tfmri.recon.adjoint</span></code></a>.</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/recon"><code class="docutils literal notranslate"><span class="pre">tfmri.recon</span></code></a>
module has several high-level interfaces for image reconstruction. The <code class="docutils literal notranslate"><span class="pre">adjoint</span></code>
interface performs reconstruction via application of the adjoint MRI linear
operator, which is constructed internally. See
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/linalg/LinearOperatorMRI"><code class="docutils literal notranslate"><span class="pre">tfmri.linalg.LinearOperatorMRI</span></code></a>
for more details on this operator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform image reconstruction. For non-Cartesian reconstruction, we need to</span>
<span class="c1"># provide the k-space data, the shape of the output image, the trajectory and,</span>
<span class="c1"># optionally, the sampling density.</span>
<span class="n">zf_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;zf_images shape:&quot;</span><span class="p">,</span> <span class="n">zf_images</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>zf_images shape: (12, 300, 300)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tfmri.recon.adjoint</span></code> supports batches of inputs. In addition, the batch shapes of
all inputs are broadcasted to obtain the output batch shape. In this case, the
coil dimension of <code class="docutils literal notranslate"><span class="pre">kspace</span></code> was interpreted as a batch dimension (multicoil
reconstruction is only triggered when <code class="docutils literal notranslate"><span class="pre">sensitivities</span></code> are specified).
<code class="docutils literal notranslate"><span class="pre">trajectory</span></code> and <code class="docutils literal notranslate"><span class="pre">density</span></code>, which have scalar batch shapes, were broadcasted to
the same shape and all coils were reconstructed in parallel. The sample
principles would apply if reconstructing multiple images with different
trajectories.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many TFMRI operators support batches of inputs. Batch dimensions are always
leading.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TensorFlow broadcasting semantics are similar to those of NumPy. Learn more
about broadcasting <a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html">here</a>.</p>
</div>
<p>Lets have a look at the reconstructed images:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_tiled_images</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

  <span class="n">artists</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">index</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">4</span>
    <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">artists</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zf_images</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Zero-filled individual coil images&#39;</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2775b165d8d048ebe1744c71104fb4ab3449fd3cda030699b30500395f9c62fb.png" src="../../../_images/2775b165d8d048ebe1744c71104fb4ab3449fd3cda030699b30500395f9c62fb.png" />
</div>
</div>
<p>Finally, lets combine the individual coil images into our final reconstruction.
TFMRI provides a very simple function <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/coils/combine_coils"><code class="docutils literal notranslate"><span class="pre">tfmri.coils.combine_coils</span></code></a>
to perform coil combination via the sum-of-squares method. If coil sensitivity
estimates are available, it can also be used to perform adaptive combination.</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/coils"><code class="docutils literal notranslate"><span class="pre">tfmri.coils</span></code></a>
module contains several utilities to operate with coil arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine all coils to create the final zero-filled reconstruction.</span>
<span class="n">zf_image</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">combine_coils</span><span class="p">(</span><span class="n">zf_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
  <span class="n">artist</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">artist</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zf_image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Zero-filled reconstruction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5b1db89ea69653b2497fd2c9e622976d7741a34df90e4dc228213e34aa99fd3a.png" src="../../../_images/5b1db89ea69653b2497fd2c9e622976d7741a34df90e4dc228213e34aa99fd3a.png" />
</div>
</div>
</section>
<section id="compute-coil-sensitivity-maps">
<h2>Compute coil sensitivity maps<a class="headerlink" href="#compute-coil-sensitivity-maps" title="Permalink to this headline"></a></h2>
<p>The zero-filled image has visible artefact because the <em>k</em>-space sampling rate
is below the Nyquist rate. Information from multiple coils can be used more
effectively to address this problem, by performing a SENSE reconstruction.</p>
<p>First we need to obtain the coil sensitivity maps. These can be estimated from
the individual coil images. A low-resolution estimate of the images is suitable
for this purpose and is easy to obtain, assuming the central part of
<em>k</em>-space is sufficiently sampled.</p>
<p>To obtain the low resolution image estimates, we will first apply a low-pass
filter to the <em>k</em>-space data. We will be using
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/signal/hann"><code class="docutils literal notranslate"><span class="pre">tfmri.signal.hann</span></code></a> and
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/signal/filter_kspace"><code class="docutils literal notranslate"><span class="pre">tfmri.signal.filter_kspace</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First let&#39;s filter the *k*-space data with a Hann window. We will apply the</span>
<span class="c1"># window to the central 20% of k-space (determined by the factor 5 below), the</span>
<span class="c1"># remaining 80% is filtered out completely.</span>
<span class="n">filter_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># Let&#39;s plot the effect of our filter.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">filter_fn</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/px)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Filter amplitude&#39;</span><span class="p">)</span>

<span class="c1"># Finally, apply the filter to the k-space data.</span>
<span class="n">filtered_kspace</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filter_kspace</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span>
                                             <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                             <span class="n">filter_fn</span><span class="o">=</span><span class="n">filter_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/0041c9ec722615f66aaff247c8bd1c24b136d0e5fc7effb46ce5e64331fc6708.png" src="../../../_images/0041c9ec722615f66aaff247c8bd1c24b136d0e5fc7effb46ce5e64331fc6708.png" />
</div>
</div>
<p>We can now reconstruct the images from the filtered <em>k</em>-space data as
described in <span class="xref myst">Perform zero-filled reconstruction</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low_res_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">filtered_kspace</span><span class="p">,</span>
                                     <span class="n">image_shape</span><span class="p">,</span>
                                     <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                     <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">low_res_images</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Low-resolution images&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/182fdd999a28d8926d18133ddf5b204b49c0aabbfb1a78fcb12f7c0e29f57ce1.png" src="../../../_images/182fdd999a28d8926d18133ddf5b204b49c0aabbfb1a78fcb12f7c0e29f57ce1.png" />
</div>
</div>
<p>Lets now use these images to obtain the coil sensitivity maps. We will use
Walshs method, one of the methods implemented in
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/coils/estimate_sensitivities">tfmri.coils.estimate_sensitivities</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sensitivities</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">estimate_sensitivities</span><span class="p">(</span>
    <span class="n">low_res_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;walsh&#39;</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sensitivities</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Coil sensitivities&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-17 19:22:47.859971: I tensorflow/stream_executor/cuda/cuda_dnn.cc:384] Loaded cuDNN version 8101
</pre></div>
</div>
<img alt="../../../_images/d39d7df0938d67011af19154decf9be0833bea82fd2f7e3495d3b063e4f037b1.png" src="../../../_images/d39d7df0938d67011af19154decf9be0833bea82fd2f7e3495d3b063e4f037b1.png" />
</div>
</div>
</section>
<section id="perform-cg-sense-reconstruction">
<h2>Perform CG-SENSE reconstruction<a class="headerlink" href="#perform-cg-sense-reconstruction" title="Permalink to this headline"></a></h2>
<p>We are finally ready to perform the SENSE reconstruction! We will be using
another of the high-level interfaces in <code class="docutils literal notranslate"><span class="pre">tfmri.recon</span></code>. In this case, we will use
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/recon/least_squares"><code class="docutils literal notranslate"><span class="pre">tfmri.recon.least_squares</span></code></a>.
This interface can be used for image reconstruction methods that arise from
a least-squares formulation, like CG-SENSE. Internally, this function will
create a <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/linalg/LinearOperatorMRI"><code class="docutils literal notranslate"><span class="pre">tfmri.linalg.LinearOperatorMRI</span></code></a>
and solve the linear system using <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/linalg/conjugate_gradient"><code class="docutils literal notranslate"><span class="pre">tfmri.linalg.conjugate_gradient</span></code></a>.</p>
<p>Usage is similar to <code class="docutils literal notranslate"><span class="pre">tfmri.recon.adjoint</span></code>, so lets have a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                  <span class="c1"># Provide trajectory.</span>
                                  <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                  <span class="c1"># Density is optional! But it might speed up</span>
                                  <span class="c1"># convergence.</span>
                                  <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
                                  <span class="c1"># Provide the coil sensitivities. Otherwise</span>
                                  <span class="c1"># this is just an iterative inverse NUFFT.</span>
                                  <span class="n">sensitivities</span><span class="o">=</span><span class="n">sensitivities</span><span class="p">,</span>
                                  <span class="c1"># Use conjugate gradient.</span>
                                  <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span>
                                  <span class="c1"># Pass any additional arguments to the</span>
                                  <span class="c1"># optimizer.</span>
                                  <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                      <span class="s1">&#39;max_iterations&#39;</span><span class="p">:</span> <span class="mi">10</span>
                                  <span class="p">},</span>
                                  <span class="c1"># Filter out the areas of *k*-space outside</span>
                                  <span class="c1"># the support of the trajectory.</span>
                                  <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Reconstructed image&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3d0dbe45dc518b7e82c386f2e29be0c914f93deeb67ca12057499466e3a4429a.png" src="../../../_images/3d0dbe45dc518b7e82c386f2e29be0c914f93deeb67ca12057499466e3a4429a.png" />
</div>
</div>
<section id="add-tikhonov-regularization">
<h3>Add Tikhonov regularization<a class="headerlink" href="#add-tikhonov-regularization" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tfmri.recon.least_squares</span></code> supports regularization. Tikhonov regularization can help
improve the conditioning of a linear system. In its simplest form, it simply
favors solutions with a low L2 norm, which can help to reduce the amount of
noise.</p>
<p>A regularizer can be specified using the <code class="docutils literal notranslate"><span class="pre">regularizer</span></code> argument of <code class="docutils literal notranslate"><span class="pre">least_squares</span></code>.
This object depends on the type of problem but in most circumstances it should
be a <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/convex/ConvexFunction"><code class="docutils literal notranslate"><span class="pre">tfmri.convex.ConvexFunction</span></code></a>.
For Tikhonov regularization, we can use
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/convex/ConvexFunctionTikhonov"><code class="docutils literal notranslate"><span class="pre">tfmri.convex.ConvexFunctionTikhonov</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/tfmri/convex"><code class="docutils literal notranslate"><span class="pre">tfmri.convex</span></code></a>
module contains many more operators for convex optimization.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the regularizer. We specify the `scale` argument (the regularization</span>
<span class="c1"># factor) and the input dtype.</span>
<span class="n">regularizer</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">convex</span><span class="o">.</span><span class="n">ConvexFunctionTikhonov</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>

<span class="n">reg_image</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                      <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                      <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
                                      <span class="n">sensitivities</span><span class="o">=</span><span class="n">sensitivities</span><span class="p">,</span>
                                      <span class="n">regularizer</span><span class="o">=</span><span class="n">regularizer</span><span class="p">,</span>
                                      <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span>
                                      <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                          <span class="s1">&#39;max_iterations&#39;</span><span class="p">:</span> <span class="mi">10</span>
                                      <span class="p">},</span>
                                      <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">reg_image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Reconstructed image (with Tikhonov regularization)&#39;</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e3d574599f51dfb7a9de0d4049418b8f1993d54c9b788039db5926220e04b5bb.png" src="../../../_images/e3d574599f51dfb7a9de0d4049418b8f1993d54c9b788039db5926220e04b5bb.png" />
</div>
</div>
</section>
</section>
<section id="consolidate-previous-steps">
<h2>Consolidate previous steps<a class="headerlink" href="#consolidate-previous-steps" title="Permalink to this headline"></a></h2>
<p>Lets put together our entire reconstruction pipeline in a single
function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconstruct_cgsense</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">,</span>
                        <span class="n">tikhonov_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Reconstructs an MR image using CG-SENSE.</span>

<span class="sd">  Sampling density and coil sensitivities are estimated automatically.</span>

<span class="sd">  Args:</span>
<span class="sd">    kspace: A `tf.Tensor` of shape `[coils, views * samples]` containing the</span>
<span class="sd">      measured k-space data.</span>
<span class="sd">    image_shape: A `list` or `tf.TensorShape` specifying the shape of the image</span>
<span class="sd">      to reconstruct.</span>
<span class="sd">    trajectory: A `tf.Tensor` of shape `[views * samples, rank]` containing the</span>
<span class="sd">      sampling locations.</span>
<span class="sd">    tikhonov_parameter: A `float` specifying the Tikhonov regularization</span>
<span class="sd">      parameter. If `None`, no regularization is applied.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `tf.Tensor` of shape `image_shape` containing the reconstructed image.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Estimate the sampling density.</span>
  <span class="n">density</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">estimate_density</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">)</span>

  <span class="c1"># Low-pass filtering of the k-space data.</span>
  <span class="n">filtered_kspace</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filter_kspace</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span>
                                               <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                               <span class="n">filter_fn</span><span class="o">=</span><span class="n">filter_fn</span><span class="p">)</span>

  <span class="c1"># Reconstruct low resolution estimates.</span>
  <span class="n">low_res_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">filtered_kspace</span><span class="p">,</span>
                                       <span class="n">image_shape</span><span class="p">,</span>
                                       <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                       <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

  <span class="c1"># Estimate the coil sensitivities.</span>
  <span class="n">sensitivities</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">estimate_sensitivities</span><span class="p">(</span>
      <span class="n">low_res_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;walsh&#39;</span><span class="p">)</span>

  <span class="c1"># Create regularizer.</span>
  <span class="k">if</span> <span class="n">tikhonov_parameter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">regularizer</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">convex</span><span class="o">.</span><span class="n">ConvexFunctionTikhonov</span><span class="p">(</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">tikhonov_parameter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">regularizer</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="c1"># Perform the reconstruction.</span>
  <span class="k">return</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span>
                                   <span class="n">trajectory</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span>
                                   <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
                                   <span class="n">sensitivities</span><span class="o">=</span><span class="n">sensitivities</span><span class="p">,</span>
                                   <span class="n">regularizer</span><span class="o">=</span><span class="n">regularizer</span><span class="p">,</span>
                                   <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span>
                                   <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                       <span class="s1">&#39;max_iterations&#39;</span><span class="p">:</span> <span class="mi">10</span>
                                   <span class="p">},</span>
                                   <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To make things more interesting, lets test it with some new data! Well use
a cardiac dataset which was also provided by the ISMRM Reproducibility
Challenge 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">heart_data_filename</span> <span class="o">=</span> <span class="s1">&#39;rawdata_heart_radial_55proj_34ch.h5&#39;</span>
<span class="n">heart_data_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/ISMRM/rrsg/raw/master/challenges/challenge_01/rawdata_heart_radial_55proj_34ch.h5&quot;</span>
<span class="o">!</span>wget --quiet -O <span class="o">{</span>heart_data_filename<span class="o">}</span> <span class="o">{</span>heart_data_url<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<p>Lets read the data and process it in the same way as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;rawdata_heart_radial_55proj_34ch.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">kspace</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;rawdata&#39;</span><span class="p">][()]</span>
  <span class="n">trajectory</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">][()]</span>

<span class="n">image_shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">240</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>

<span class="c1"># Convert k-space to TFMRI format.</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">kspace</span><span class="p">)</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Convert trajectory to TFMRI format.</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">image_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">trajectory</span> <span class="o">*=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now perform the reconstruction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">reconstruct_cgsense</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">,</span>
                            <span class="n">tikhonov_parameter</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_image</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Reconstructed image&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/6c8889fa0a815796561038a1d581a6f9ba82ba76944c0c1b20bca175640de810.png" src="../../../_images/6c8889fa0a815796561038a1d581a6f9ba82ba76944c0c1b20bca175640de810.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="we-will-also-try-a-2d-t-non-cartesian-sense-example">
<h1>We will also try a 2D+t non-Cartesian SENSE example<a class="headerlink" href="#we-will-also-try-a-2d-t-non-cartesian-sense-example" title="Permalink to this headline"></a></h1>
<p>Firstly get the dataset from google drive
This is a prospective radial undersampled dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdown</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://drive.google.com/uc?id=1nxJgqxOwFLIlO0Cz4NfhvYrB7_3C5Rhy&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;/workspaces/Tutorials/UPLOADED_radialCGsense2D/radiallyUndersampledProspectiveData_fromG.npy&#39;</span>
<span class="n">gdown</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now read the data, and calculate the trajectory and density weights for this prospective data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/workspaces/Tutorials/UPLOADED_radialCGsense2D/radiallyUndersampledProspectiveData_fromG.npy&#39;</span><span class="p">)</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;raw data shape:&#39;</span><span class="p">,</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># (512, 30, 13, 27)</span>
<span class="c1"># nPtsPerSpoke, nCh, nSpokes, nTimePoints</span>

<span class="n">nSpokes</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">nTimePts</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

<span class="n">kspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> 
<span class="c1">#(time, coils, spokes, readout)</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kspace</span><span class="p">,(</span><span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">sh</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kspace shape: &#39;</span><span class="p">,</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1">#(time, coils, spokes*readout)</span>
<span class="c1"># (27, 30, 6656)</span>

<span class="n">im_size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">image_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">im_size</span><span class="p">,</span> <span class="n">im_size</span><span class="p">]</span>

<span class="c1"># Compute trajectory.</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">radial_trajectory</span><span class="p">(</span><span class="n">base_resolution</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span>
                                                <span class="n">views</span><span class="o">=</span><span class="n">nSpokes</span><span class="p">,</span>
                                                <span class="n">phases</span><span class="o">=</span><span class="n">nTimePts</span><span class="p">,</span>
                                                <span class="n">ordering</span><span class="o">=</span><span class="s1">&#39;sorted_half&#39;</span><span class="p">,</span>
                                                <span class="n">angle_range</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;traj shape: &#39;</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1">#(time, spokes, readout, 2)</span>
<span class="c1"># (27, 13, 512, 2)</span>

<span class="c1"># Compute density.</span>
<span class="n">dens</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">estimate_density</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pipe&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;density.shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dens</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="c1"># #(time, spokes, readout)</span>
<span class="c1">#density.shape: (27, 13, 512)</span>

<span class="c1"># Flatten trajectory and density.</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">flatten_trajectory</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
<span class="c1"># This should be size: [nTimePts, nPtsPerSpoke*nSpokes, 2]</span>
<span class="c1">#trajectory.shape: (27, 6656, 2)</span>

<span class="n">dens</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">flatten_density</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span>
<span class="c1"># This should be size: [nTimePts, nPtsPerSpoke*nSpokes]</span>
<span class="c1">#trajectory.shape: (27, 6656)</span>

<span class="c1"># And compress to 12 coil elements</span>
<span class="n">kspace</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">compress_coils</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_coils</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kspace:&#39;</span><span class="p">,</span> <span class="n">kspace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1">#(time, coils, spokes*readout)</span>
<span class="c1">#kspace: (27, 12, 6656)</span>
</pre></div>
</div>
</div>
</div>
<p>And calculate the coil sensitivity info for this dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now calcualte coil sensitivities by collapsing through time and gridding</span>

<span class="n">kSpaceCS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="c1">#(coils, time,spokes*readout)</span>
<span class="c1"># (12, 27, 6656)</span>

<span class="n">kSpaceCS</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kSpaceCS</span><span class="p">,</span> <span class="p">[</span><span class="n">kSpaceCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kSpaceCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">kSpaceCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<span class="c1">#kSpaceCS:  (27, 199680)</span>
<span class="n">trajCS</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="p">[</span><span class="n">traj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">traj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">traj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<span class="c1">#trajCS:  (179712, 2)</span>
<span class="n">densCS</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="p">[</span><span class="n">dens</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dens</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># First let&#39;s filter the *k*-space data with a Hann window. We will apply the</span>
<span class="c1"># window to the central 20% of k-space (determined by the factor 5 below), the</span>
<span class="c1"># remaining 80% is filtered out completely.</span>
<span class="n">filter_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># Low-pass filtering of the k-space data.</span>
<span class="n">filtered_kspace</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filter_kspace</span><span class="p">(</span><span class="n">kSpaceCS</span><span class="p">,</span>
                                               <span class="n">trajectory</span><span class="o">=</span><span class="n">trajCS</span><span class="p">,</span>
                                               <span class="n">filter_fn</span><span class="o">=</span><span class="n">filter_fn</span><span class="p">)</span>

<span class="c1"># Reconstruct low resolution estimates.</span>
<span class="n">low_res_images</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">filtered_kspace</span><span class="p">,</span>
                                       <span class="n">image_shape</span><span class="p">,</span>
                                       <span class="n">trajectory</span><span class="o">=</span><span class="n">trajCS</span><span class="p">,</span>
                                       <span class="n">density</span><span class="o">=</span><span class="n">densCS</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">low_res_images</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Low-resolution images&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># Estimate the coil sensitivities.</span>
<span class="n">coil_sens</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">coils</span><span class="o">.</span><span class="n">estimate_sensitivities</span><span class="p">(</span>
    <span class="n">low_res_images</span><span class="p">,</span> <span class="n">coil_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;walsh&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sensitivities.shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coil_sens</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="c1"># This should be size: [nCoils, matrix_size, matrix_size]</span>
<span class="c1">#sensitivities.shape: (12, 256, 256)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tiled_images</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coil_sens</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Coil Sensitivities&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lastly do iterative SENSE</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">domain_shape</span> <span class="o">=</span><span class="p">[</span><span class="n">nTimePts</span><span class="p">,</span> <span class="n">im_size</span><span class="p">,</span> <span class="n">im_size</span><span class="p">]</span> <span class="c1">#, dtype=tf.int32)</span>

<span class="c1">#Create regularizer.</span>
<span class="n">tikhonov_parameter</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">regularizer</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">convex</span><span class="o">.</span><span class="n">ConvexFunctionTikhonov</span><span class="p">(</span> <span class="n">scale</span><span class="o">=</span><span class="n">tikhonov_parameter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>

                                                                
<span class="c1"># this should have the shape [t*x*y,]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;regularizer.shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">regularizer</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> 
<span class="c1"># regularizer.shape: ((1769472,)</span>

<span class="n">senserecon</span> <span class="o">=</span> <span class="n">tfmri</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">kspace</span><span class="p">,</span>                             <span class="c1"># correct</span>
                                    <span class="n">image_shape</span><span class="p">,</span>                <span class="c1"># correct</span>
                                    <span class="n">extra_shape</span><span class="o">=</span><span class="n">nTimePts</span><span class="p">,</span>    <span class="c1"># correct</span>
                                    <span class="n">trajectory</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span>            <span class="c1"># correct</span>
                                    <span class="n">density</span><span class="o">=</span><span class="n">dens</span><span class="p">,</span>               <span class="c1"># correct</span>
                                    <span class="n">sensitivities</span><span class="o">=</span><span class="n">coil_sens</span><span class="p">,</span>    <span class="c1"># correct</span>
                                    <span class="n">regularizer</span><span class="o">=</span><span class="n">regularizer</span><span class="p">,</span>    <span class="c1"># correct</span>
                                    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span>
                                    <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;max_iterations&#39;</span><span class="p">:</span> <span class="mi">20</span>
                                    <span class="p">},</span>
                                    <span class="n">filter_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">senserecon</span><span class="p">))</span>


<span class="c1"># And lets visualise</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;animation.html&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jshtml&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">t</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nTimePts</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">senserecon</span><span class="p">[</span><span class="n">t</span><span class="p">,:,:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;iterative SENSE Recon&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.animation</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">nTimePts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ths data is 24x undersampled so its not a great suprise that SENSE didnt resolve all of the artefacts!</p>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline"></a></h2>
<p>Congratulations! You performed a non-Cartesian CG-SENSE reconstruction using
TensorFlow MRI. The code used in this notebook works for any dataset and
trajectory. It also works for 3D imaging. Feel free to try with your own data!</p>
<p>For more information about the functions used in this tutorial, check out the
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/api_docs/">API documentation</a>. For
more examples of using TensorFlow MRI, check out the
<a class="reference external" href="https://mrphys.github.io/tensorflow-mri/tutorials/">tutorials</a>.</p>
<section id="let-us-know">
<h3>Let us know!<a class="headerlink" href="#let-us-know" title="Permalink to this headline"></a></h3>
<p>Please tell us what you think about this tutorial and about TensorFlow MRI.
We would like to hear what you liked and how we can improve. You will find us
on <a class="reference external" href="https://github.com/mrphys/tensorflow-mri/issues/new">GitHub</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright 2022 University College London. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../ProcessingRFHdata/" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">We need to read the raw data from the scanner (In siemens this is stored as a .dat file)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../radial_CS/" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Image reconstruction with Compressed Sensing (2D and 2D+time)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Javier Montalt Tordera<br/>
  
      &copy; Copyright 2021 University College London.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
    <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  

  </body>
</html>